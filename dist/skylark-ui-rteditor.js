/**
 * skylark-ui-rteditor - The skylark rteditor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylarkui/skylark-ui-rteditor/
 * @license MIT
 */
!function(t,e){var i=e.define,r=e.require,o="function"==typeof i&&i.amd,n=!o&&"undefined"!=typeof exports;if(!o&&!i){var a={};i=e.define=function(t,e,i){"function"==typeof i?(a[t]={factory:i,deps:e.map(function(e){return function(t,e){if("."!==t[0])return t;var i=e.split("/"),r=t.split("/");i.pop();for(var o=0;o<r.length;o++)"."!=r[o]&&(".."==r[o]?i.pop():i.push(r[o]));return i.join("/")}(e,t)}),resolved:!1,exports:null},r(t)):a[t]={factory:null,resolved:!0,exports:i}},r=e.require=function(t){if(!a.hasOwnProperty(t))throw new Error("Module "+t+" has not been defined");var i=a[t];if(!i.resolved){var o=[];i.deps.forEach(function(t){o.push(r(t))}),i.exports=i.factory.apply(e,o)||null,i.resolved=!0}return i.exports}}if(!i)throw new Error("The module utility (ex: requirejs or skylark-utils) is not loaded!");if(function(t,e){t([],function(){"use strict";var e={},i={exports:{}};function r(t){return"object"!=typeof t||Array.isArray(t)||!function(t){var e;for(e in t)return!1;return!0}(t)}return t(["skylark-langx/langx","skylark-utils-dom/query","skylark-ui-contents/editable","./Toolbar","./uploader","./i18n"],function(t,e,i,r,o,n){var a=t.Evented.inherit({init:function(n){var l,s;if(this.opts=t.extend({},this.opts,n),this.textarea=e(this.opts.textarea),this.opts.placeholder=this.opts.placeholder||this.textarea.attr("placeholder"),!this.textarea.length)throw new Error("richeditor: param textarea is required.");null!=(l=this.textarea.data("richeditor"))&&l.destroy(),this.id=++a.count,this._render();var d=this;if(this.editable=i(this.el,{classPrefix:"richeditor-",textarea:this.textarea,body:this.body}),this.editable.on("all",function(t,e){return d.trigger(t.type,e)}),this.opts.upload&&o&&(s="object"==typeof this.opts.upload?this.opts.upload:{},this.uploader=o(s)),this.toolbar=new r(this,{toolbar:this.opts.toolbar,toolbarFloat:this.opts.toolbarFloat,toolbarHidden:this.opts.toolbarHidden,toolbarFloatOffset:this.opts.toolbarFloatOffset}),this.opts.placeholder&&this.on("valuechanged",function(){return d._placeholder()}),this.setValue(this.textarea.val().trim()||""),this.textarea.attr("autofocus"))return d.focus()}});return a.prototype.triggerHandler=a.prototype.trigger=function(e,i){var r;return r=[e],i&&(r=r.concat(i)),t.Evented.prototype.trigger.apply(this,r),this},a.count=0,a.prototype.opts={textarea:null,placeholder:"",defaultImage:"images/image.png",params:{},upload:!1},a.prototype._tpl='<div class="richeditor">\n  <div class="richeditor-wrapper">\n    <div class="richeditor-placeholder"></div>\n    <div class="richeditor-body" contenteditable="true">\n    </div>\n  </div>\n</div>',a.prototype._render=function(){var t,i,r,o;if(this.el=e(this._tpl).insertBefore(this.textarea),this.wrapper=this.el.find(".richeditor-wrapper"),this.body=this.wrapper.find(".richeditor-body"),this.placeholderEl=this.wrapper.find(".richeditor-placeholder").append(this.opts.placeholder),this.el.data("richeditor",this),this.wrapper.append(this.textarea),this.textarea.data("richeditor",this).blur(),this.body.attr("tabindex",this.textarea.attr("tabindex")),this.opts.params){for(t in i=this.opts.params,r=[],i)o=i[t],r.push(e("<input/>",{type:"hidden",name:t,value:o}).insertAfter(this.textarea));return r}},a.prototype._placeholder=function(){var t;return 0===(t=this.body.children()).length||1===t.length&&this.util.isEmptyNode(t)&&parseInt(t.css("margin-left")||0)<this.opts.indentWidth?this.placeholderEl.show():this.placeholderEl.hide()},a.prototype.setValue=function(t){return this.hidePopover(),this.editable.setValue(t),this.trigger("valuechanged")},a.prototype.getValue=function(){return this.editable.getValue()},a.prototype.focus=function(){return this.editable.focus()},a.prototype.blur=function(){return this.editable.blur()},a.prototype.hidePopover=function(){return this.el.find(".richeditor-popover").each(function(t,i){if((i=e(i).data("popover")).active)return i.hide()})},a.prototype.destroy=function(){return this.triggerHandler("destroy"),this.textarea.closest("form").off(".richeditor .richeditor-"+this.id),this.selection.clear(),this.inputManager.focused=!1,this.textarea.insertBefore(this.el).hide().val("").removeData("richeditor"),this.el.remove(),e(document).off(".richeditor-"+this.id),e(window).off(".richeditor-"+this.id),this.off()},a.Toolbar=r,a.i18n=n,a}),r(i.exports)?i.exports:r(e)?e:void 0}),t("skylark-ui-rteditor/RichEditor",function(){}),t("skylark-ui-rteditor/i18n",[],function(){var t={"zh-CN":{blockquote:"引用",bold:"加粗文字",code:"插入代码",color:"文字颜色",coloredText:"彩色文字",hr:"分隔线",image:"插入图片",externalImage:"外链图片",uploadImage:"上传图片",uploadFailed:"上传失败了",uploadError:"上传出错了",imageUrl:"图片地址",imageSize:"图片尺寸",imageAlt:"图片描述",restoreImageSize:"还原图片尺寸",uploading:"正在上传",indent:"向右缩进",outdent:"向左缩进",italic:"斜体文字",link:"插入链接",linkText:"链接文字",linkUrl:"链接地址",linkTarget:"打开方式",openLinkInCurrentWindow:"在当前窗口中打开",openLinkInNewWindow:"在新窗口中打开",removeLink:"移除链接",ol:"有序列表",ul:"无序列表",strikethrough:"删除线文字",table:"表格",deleteRow:"删除行",insertRowAbove:"在上面插入行",insertRowBelow:"在下面插入行",deleteColumn:"删除列",insertColumnLeft:"在左边插入列",insertColumnRight:"在右边插入列",deleteTable:"删除表格",title:"标题",normalText:"普通文本",underline:"下划线文字",alignment:"水平对齐",alignCenter:"居中",alignLeft:"居左",alignRight:"居右",selectLanguage:"选择程序语言",fontScale:"字体大小",fontScaleXLarge:"超大字体",fontScaleLarge:"大号字体",fontScaleNormal:"正常大小",fontScaleSmall:"小号字体",fontScaleXSmall:"超小字体"},"en-US":{blockquote:"Block Quote",bold:"Bold",code:"Code",color:"Text Color",coloredText:"Colored Text",hr:"Horizontal Line",image:"Insert Image",externalImage:"External Image",uploadImage:"Upload Image",uploadFailed:"Upload failed",uploadError:"Error occurs during upload",imageUrl:"Url",imageSize:"Size",imageAlt:"Alt",restoreImageSize:"Restore Origin Size",uploading:"Uploading",indent:"Indent",outdent:"Outdent",italic:"Italic",link:"Insert Link",linkText:"Text",linkUrl:"Url",linkTarget:"Target",openLinkInCurrentWindow:"Open link in current window",openLinkInNewWindow:"Open link in new window",removeLink:"Remove Link",ol:"Ordered List",ul:"Unordered List",strikethrough:"Strikethrough",table:"Table",deleteRow:"Delete Row",insertRowAbove:"Insert Row Above",insertRowBelow:"Insert Row Below",deleteColumn:"Delete Column",insertColumnLeft:"Insert Column Left",insertColumnRight:"Insert Column Right",deleteTable:"Delete Table",title:"Title",normalText:"Text",underline:"Underline",alignment:"Alignment",alignCenter:"Align Center",alignLeft:"Align Left",alignRight:"Align Right",selectLanguage:"Select Language",fontScale:"Font Size",fontScaleXLarge:"X Large Size",fontScaleLarge:"Large Size",fontScaleNormal:"Normal Size",fontScaleSmall:"Small Size",fontScaleXSmall:"X Small Size"},translate:function(){var e,i,r,o;return i=arguments[0],e=2<=arguments.length?Array.prototype.slice.call(arguments,1):[],o=(null!=(r=t[this.locale])?r[i]:void 0)||"",e.length>0?(o=o.replace(/([^%]|^)%(?:(\d+)\$)?s/g,function(t,i,r){return r?i+e[parseInt(r)-1]:i+e.shift()})).replace(/%%s/g,"%s"):o}};return t}),t("skylark-ui-rteditor/Button",["skylark-langx/langx","skylark-utils-dom/query","./RichEditor","./i18n"],function(t,e,i,r){var o=t.Evented.inherit({init:function(t){this.toolbar=t.toolbar,this.editor=t.toolbar.editor,this.title=r.translate(this.name),this._init()}});return o.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},o.prototype.name="",o.prototype.icon="",o.prototype.title="",o.prototype.text="",o.prototype.htmlTag="",o.prototype.disableTag="",o.prototype.menu=!1,o.prototype.active=!1,o.prototype.disabled=!1,o.prototype.needFocus=!0,o.prototype.shortcut=null,o.prototype._init=function(){var i,r,o,n,a;for(this.render(),this.el.on("mousedown",(a=this,function(t){var e,i;return t.preventDefault(),e=a.needFocus&&!a.editor.editable.inputManager.focused,!a.el.hasClass("disabled")&&(e&&a.editor.focus(),a.menu?(a.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),a.wrapper.is(".menu-on")&&(a.menuWrapper.offset().left+a.menuWrapper.outerWidth()+5-a.editor.wrapper.offset().left-a.editor.wrapper.outerWidth()>0&&a.menuWrapper.css({left:"auto",right:0}),a.trigger("menuexpand")),!1):(i=a.el.data("param"),a.command(i),!1))})),this.wrapper.on("click","a.menu-item",function(t){return function(i){var r,o,n;return i.preventDefault(),r=e(i.currentTarget),t.wrapper.removeClass("menu-on"),o=t.needFocus&&!t.editor.editable.inputManager.focused,!r.hasClass("disabled")&&!o&&(t.toolbar.wrapper.removeClass("menu-on"),n=r.data("param"),t.command(n),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(t){return!1}),this.editor.on("blur",function(t){return function(){if(t.editor.body.is(":visible")&&t.editor.body.is("[contenteditable]")&&!t.editor.editable.clipboard.pasting)return t.setActive(!1),t.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.editable.hotkeys.add(this.shortcut,function(t){return function(e){return t.el.mousedown(),!1}}(this)),o=this.htmlTag.split(","),i=0,r=o.length;i<r;i++)n=o[i],(n=t.trim(n))&&t.inArray(n,this.editor.editable.formatter._allowedTags)<0&&this.editor.editable.formatter._allowedTags.push(n);return this.editor.on("selectionchanged",function(t){return function(e){if(t.editor.editable.inputManager.focused)return t._status()}}(this))},o.prototype.iconClassOf=function(t){return t?"richeditor-icon richeditor-icon-"+t:""},o.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},o.prototype.render=function(){if(this.wrapper=e(this._tpl.item).appendTo(this.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=e(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},o.prototype.renderMenu=function(){var i,r,o,n,a,l,s,d;if(t.isArray(this.menu)){for(this.menuEl=e("<ul/>").appendTo(this.menuWrapper),l=this.menu,d=[],o=0,n=l.length;o<n;o++)"|"!==(a=l[o])?(r=e(this._tpl.menuItem).appendTo(this.menuEl),i=r.find("a.menu-item").attr({title:null!=(s=a.title)?s:a.text,"data-param":a.param}).addClass("menu-item-"+a.name),a.icon?d.push(i.find("span").addClass(this.iconClassOf(a.icon))):d.push(i.find("span").text(a.text))):e(this._tpl.separator).appendTo(this.menuEl);return d}},o.prototype.setActive=function(t){if(t!==this.active)return this.active=t,this.el.toggleClass("active",this.active)},o.prototype.setDisabled=function(t){if(t!==this.disabled)return this.disabled=t,this.el.toggleClass("disabled",this.disabled)},o.prototype._disableStatus=function(){var t,e,i;return i=this.editor.editable.selection.startNodes(),e=this.editor.editable.selection.endNodes(),t=i.filter(this.disableTag).length>0||e.filter(this.disableTag).length>0,this.setDisabled(t),this.disabled&&this.setActive(!1),this.disabled},o.prototype._activeStatus=function(){var t,e,i,r,o;return o=this.editor.editable.selection.startNodes(),i=this.editor.editable.selection.endNodes(),r=o.filter(this.htmlTag),e=i.filter(this.htmlTag),t=r.length>0&&e.length>0&&r.is(e),this.node=t?r:null,this.setActive(t),this.active},o.prototype._status=function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},o.prototype.command=function(t){},o.prototype._t=r.translate,i.Button=o,o}),t("skylark-ui-rteditor/Popover",["skylark-langx/langx","skylark-utils-dom/query","./RichEditor","./i18n"],function(t,e,i,r){var o=t.Evented.inherit({init:function(t){this.button=t.button,this.editor=t.button.editor,this._init()}});return o.prototype.offset={top:4,left:0},o.prototype.target=null,o.prototype.active=!1,o.prototype._init=function(){var t;return this.el=e('<div class="richeditor-popover"></div>').appendTo(this.editor.el).data("popover",this),this.render(),this.el.on("mouseenter",(t=this,function(e){return t.el.addClass("hover")})),this.el.on("mouseleave",function(t){return function(e){return t.el.removeClass("hover")}}(this))},o.prototype.render=function(){},o.prototype._initLabelWidth=function(){var t,i;if((t=this.el.find(".settings-field")).length>0)return this._labelWidth=0,t.each((i=this,function(t,r){var o,n;if(o=e(r),(n=o.find("label")).length>0)return i._labelWidth=Math.max(i._labelWidth,n.width())})),t.find("label").width(this._labelWidth)},o.prototype.show=function(t,i){if(null==i&&(i="bottom"),null!=t)return this.el.siblings(".richeditor-popover").each(function(t,i){if((i=e(i).data("popover")).active)return i.hide()}),this.active&&this.target&&this.target.removeClass("selected"),this.target=t.addClass("selected"),this.active?(this.refresh(i),this.trigger("popovershow")):(this.active=!0,this.el.css({left:-9999}).show(),this._labelWidth||this._initLabelWidth(),this.editor.editable.util.reflow(),this.refresh(i),this.trigger("popovershow"))},o.prototype.hide=function(){if(this.active)return this.target&&this.target.removeClass("selected"),this.target=null,this.active=!1,this.el.hide(),this.trigger("popoverhide")},o.prototype.refresh=function(t){var e,i,r,o,n,a;if(null==t&&(t="bottom"),this.active)return e=this.editor.el.offset(),n=this.target.offset(),o=this.target.outerHeight(),"bottom"===t?a=n.top-e.top+o:"top"===t&&(a=n.top-e.top-this.el.height()),r=this.editor.wrapper.width()-this.el.outerWidth()-10,i=Math.min(n.left-e.left,r),this.el.css({top:a+this.offset.top,left:i+this.offset.left})},o.prototype.destroy=function(){return this.target=null,this.active=!1,this.editor.off(".linkpopover"),this.el.remove()},o.prototype._t=function(t){var e;return e=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],r.translate.apply(r,e)},i.Popover=o,o}),t("skylark-ui-rteditor/Toolbar",["skylark-langx/langx","skylark-utils-dom/query"],function(t,e){var i=t.Evented.inherit({init:function(i,r){var o,n,a,l;(this.editor=i,this.opts=t.extend({},this.opts,r),this.opts.toolbar)&&(t.isArray(this.opts.toolbar)||(this.opts.toolbar=["bold","italic","underline","strikethrough","|","ol","ul","blockquote","code","|","link","image","|","indent","outdent"]),this._render(),this.list.on("click",function(t){return!1}),this.wrapper.on("mousedown",(l=this,function(t){return l.list.find(".menu-on").removeClass(".menu-on")})),e(document).on("mousedown.richeditor"+this.editor.id,function(t){return function(e){return t.list.find(".menu-on").removeClass(".menu-on")}}(this)),!this.opts.toolbarHidden&&this.opts.toolbarFloat&&(this.wrapper.css("top",this.opts.toolbarFloatOffset),a=0,n=function(t){return function(){return t.wrapper.css("position","static"),t.wrapper.width("auto"),t.editor.editable.util.reflow(t.wrapper),t.wrapper.width(t.wrapper.outerWidth()),t.wrapper.css("left",t.editor.editable.util.os.mobile?t.wrapper.position().left:t.wrapper.offset().left),t.wrapper.css("position",""),a=t.wrapper.outerHeight(),t.editor.placeholderEl.css("top",a),!0}}(this),o=null,e(window).on("resize.richeditor-"+this.editor.id,function(t){return o=n()}),e(window).on("scroll.richeditor-"+this.editor.id,function(t){return function(i){var r,l,s;if(t.wrapper.is(":visible"))if(s=t.editor.wrapper.offset().top,r=s+t.editor.wrapper.outerHeight()-80,(l=e(document).scrollTop()+t.opts.toolbarFloatOffset)<=s||l>=r){if(t.editor.wrapper.removeClass("toolbar-floating").css("padding-top",""),t.editor.editable.util.os.mobile)return t.wrapper.css("top",t.opts.toolbarFloatOffset)}else if(o||(o=n()),t.editor.wrapper.addClass("toolbar-floating").css("padding-top",a),t.editor.editable.util.os.mobile)return t.wrapper.css("top",l-s+t.opts.toolbarFloatOffset)}}(this))),this.editor.on("destroy",function(t){return function(){return t.buttons.length=0}}(this)),e(document).on("mousedown.richeditor-"+this.editor.id,function(t){return function(e){return t.list.find("li.menu-on").removeClass("menu-on")}}(this)))}});return i.pluginName="Toolbar",i.prototype.opts={toolbar:!0,toolbarFloat:!0,toolbarHidden:!1,toolbarFloatOffset:0},i.prototype._tpl={wrapper:'<div class="richeditor-toolbar"><ul></ul></div>',separator:'<li><span class="separator"></span></li>'},i.prototype._render=function(){var t,i,r,o;for(this.buttons=[],this.wrapper=e(this._tpl.wrapper).prependTo(this.editor.wrapper),this.list=this.wrapper.find("ul"),o=this.opts.toolbar,t=0,i=o.length;t<i;t++)if("|"!==(r=o[t])){if(!this.constructor.buttons[r])throw new Error("richeditor: invalid toolbar button "+r);this.buttons.push(new this.constructor.buttons[r]({toolbar:this,editor:this.editor}))}else e(this._tpl.separator).appendTo(this.list);if(this.opts.toolbarHidden)return this.wrapper.hide()},i.prototype.findButton=function(t){var e;return null!=(e=this.list.find(".toolbar-item-"+t).data("button"))?e:null},i.addButton=function(t){return this.buttons[t.prototype.name]=t},i.buttons={},i}),t("skylark-ui-rteditor/buttons/AlignmentButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","../i18n"],function(t,e,i,r,o){var n=r.inherit({});return n.prototype.name="alignment",n.prototype.icon="align-left",n.prototype.htmlTag="p, h1, h2, h3, h4, td, th",n.prototype._init=function(){return this.menu=[{name:"left",text:o.translate("alignLeft"),icon:"align-left",param:"left"},{name:"center",text:o.translate("alignCenter"),icon:"align-center",param:"center"},{name:"right",text:o.translate("alignRight"),icon:"align-right",param:"right"}],r.prototype._init.call(this)},n.prototype.setActive=function(t,e){return null==e&&(e="left"),"left"!==e&&"center"!==e&&"right"!==e&&(e="left"),"left"===e?r.prototype.setActive.call(this,!1):r.prototype.setActive.call(this,t),this.el.removeClass("align-left align-center align-right"),t&&this.el.addClass("align-"+e),this.setIcon("align-"+e),this.menuEl.find(".menu-item").show().end().find(".menu-item-"+e).hide()},n.prototype._status=function(){var t=this.editor.editable.status("alignment",this.htmlTag);return t?(this.setDisabled(!1),this.setActive(!0,t)):(this.setDisabled(!0),this.setActive(!1))},n.prototype.command=function(t){return this.editor.editable.alignment(t,this.htmlTag)},i.Toolbar.addButton(n),n}),t("skylark-ui-rteditor/buttons/BlockquoteButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="blockquote",o.prototype.icon="quote-left",o.prototype.htmlTag="blockquote",o.prototype.disableTag="pre, table",o.prototype.command=function(){return this.editor.editable.blockquote(this.htmlTag,this.disableTag)},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/BoldButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="bold",o.prototype.icon="bold",o.prototype.htmlTag="b, strong",o.prototype.disableTag="pre",o.prototype.shortcut="cmd+b",o.prototype._init=function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + b )":(this.title=this.title+" ( Ctrl + b )",this.shortcut="ctrl+b"),r.prototype._init.call(this)},o.prototype._activeStatus=function(){var t;return t=this.editor.editable.isActive("bold"),this.setActive(t),this.active},o.prototype.command=function(){return this.editor.editable.bold()},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/CodePopover",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Popover"],function(t,e,i,r){var o=r.inherit({});return o.prototype.render=function(){var e,i,r,o,n;for(this._tpl='<div class="code-settings">\n  <div class="settings-field">\n    <select class="select-lang">\n      <option value="-1">'+this._t("selectLanguage")+"</option>\n    </select>\n  </div>\n</div>",this.langs=this.editor.opts.codeLanguages||[{name:"Bash",value:"bash"},{name:"C++",value:"c++"},{name:"C#",value:"cs"},{name:"CSS",value:"css"},{name:"Erlang",value:"erlang"},{name:"Less",value:"less"},{name:"Sass",value:"sass"},{name:"Diff",value:"diff"},{name:"CoffeeScript",value:"coffeescript"},{name:"HTML,XML",value:"html"},{name:"JSON",value:"json"},{name:"Java",value:"java"},{name:"JavaScript",value:"js"},{name:"Markdown",value:"markdown"},{name:"Objective C",value:"oc"},{name:"PHP",value:"php"},{name:"Perl",value:"parl"},{name:"Python",value:"python"},{name:"Ruby",value:"ruby"},{name:"SQL",value:"sql"}],this.el.addClass("code-popover").append(this._tpl),this.selectEl=this.el.find(".select-lang"),o=this.langs,e=0,r=o.length;e<r;e++)i=o[e],t("<option/>",{text:i.name,value:i.value}).appendTo(this.selectEl);return this.selectEl.on("change",(n=this,function(t){var e;return n.lang=n.selectEl.val(),e=n.target.hasClass("selected"),n.target.removeClass().removeAttr("data-lang"),-1!==n.lang&&n.target.attr("data-lang",n.lang),e&&n.target.addClass("selected"),n.editor.trigger("valuechanged")})),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this))},o.prototype.show=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],r.prototype.show.apply(this,t),this.lang=this.target.attr("data-lang"),null!=this.lang?this.selectEl.val(this.lang):this.selectEl.val(-1)},o}),t("skylark-ui-rteditor/buttons/CodeButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","./CodePopover"],function(t,e,i,r,o){var n=r.inherit({});return n.prototype.name="code",n.prototype.icon="code",n.prototype.htmlTag="pre",n.prototype.disableTag="ul, ol, table",n.prototype._init=function(){var e;return r.prototype._init.call(this),this.editor.on("decorate",(e=this,function(i,r){return r.find("pre").each(function(i,r){return e.decorate(t(r))})})),this.editor.on("undecorate",function(e){return function(i,r){return r.find("pre").each(function(i,r){return e.undecorate(t(r))})}}(this))},n.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],r.prototype.render.apply(this,t),this.popover=new o({button:this})},n.prototype._checkMode=function(){var e;return e=this.editor.editable.selection.range(),t(e.cloneContents()).find(this.editor.editable.util.blockNodes.join(","))>0||e.collapsed&&0===this.editor.editable.selection.startNodes().filter("code").length?(this.inlineMode=!1,this.htmlTag="pre"):(this.inlineMode=!0,this.htmlTag="code")},n.prototype._status=function(){if(this._checkMode(),r.prototype._status.call(this),!this.inlineMode)return this.active?this.popover.show(this.node):this.popover.hide()},n.prototype.decorate=function(t){var e,i,r,o;if((e=t.find("> code")).length>0&&(i=null!=(r=e.attr("class"))&&null!=(o=r.match(/lang-(\S+)/))?o[1]:void 0,e.contents().unwrap(),i))return t.attr("data-lang",i)},n.prototype.undecorate=function(e){var i,r;return r=e.attr("data-lang"),i=t("<code/>"),r&&-1!==r&&i.addClass("lang-"+r),e.wrapInner(i).removeAttr("data-lang")},n.prototype.command=function(){return this.inlineMode?this._inlineCommand():this._blockCommand()},n.prototype._blockCommand=function(){return this.editor.editable.blockCode(this.htmlTag,this.disableTag)},n.prototype._inlineCommand=function(){return this.editor.editable.inlineCode(this.active)},i.Toolbar.addButton(n),n}),t("skylark-ui-rteditor/buttons/ColorButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","../i18n"],function(t,e,i,r,o){var n=r.inherit({});return n.prototype.name="color",n.prototype.icon="tint",n.prototype.disableTag="pre",n.prototype.menu=!0,n.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],r.prototype.render.apply(this,t)},n.prototype.renderMenu=function(){return t('<ul class="color-list">\n  <li><a href="javascript:;" class="font-color font-color-1"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-2"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-3"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-4"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-5"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-6"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-7"></a></li>\n  <li><a href="javascript:;" class="font-color font-color-default"></a></li>\n</ul>').appendTo(this.menuWrapper),this.menuWrapper.on("mousedown",".color-list",function(t){return!1}),this.menuWrapper.on("click",".font-color",(e=this,function(i){var r,n,a,l;if(e.wrapper.removeClass("menu-on"),(r=t(i.currentTarget)).hasClass("font-color-default")){if(!((n=e.editor.body.find("p, li")).length>0))return;l=window.getComputedStyle(n[0],null).getPropertyValue("color"),a=e._convertRgbToHex(l)}else l=window.getComputedStyle(r[0],null).getPropertyValue("background-color"),a=e._convertRgbToHex(l);if(a)return e.editor.editable.fontColor(a,r.hasClass("font-color-default"),o.translate("coloredText"))}));var e},n.prototype._convertRgbToHex=function(t){var e;return(e=/rgb\((\d+),\s?(\d+),\s?(\d+)\)/g.exec(t))?function(t,e,i){var r;return"#"+(r=function(t){var e;return 1===(e=t.toString(16)).length?"0"+e:e})(t)+r(e)+r(i)}(1*e[1],1*e[2],1*e[3]):""},i.Toolbar.addButton(n),n}),t("skylark-ui-rteditor/buttons/FontScaleButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","../i18n"],function(t,e,i,r,o){var n=r.inherit({});return n.prototype.name="fontScale",n.prototype.icon="font",n.prototype.htmlTag="span",n.prototype.disableTag="pre, h1, h2, h3, h4, h5",n.prototype._init=function(){return this.menu=[{name:"150%",text:o.translate("fontScaleXLarge"),param:"5"},{name:"125%",text:o.translate("fontScaleLarge"),param:"4"},{name:"100%",text:o.translate("fontScaleNormal"),param:"3"},{name:"75%",text:o.translate("fontScaleSmall"),param:"2"},{name:"50%",text:o.translate("fontScaleXSmall"),param:"1"}],r.prototype._init.call(this)},n.prototype._activeStatus=function(){var t,e,i,r,o;return this.editor.editable.selection.range(),o=this.editor.editable.selection.startNodes(),i=this.editor.editable.selection.endNodes(),r=o.filter('span[style*="font-size"]'),e=i.filter('span[style*="font-size"]'),t=o.length>0&&i.length>0&&r.is(e),this.setActive(t),this.active},n.prototype.command=function(t){return this.editor.editable.fontScale(t)},i.Toolbar.addButton(n),n}),t("skylark-ui-rteditor/buttons/HrButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="hr",o.prototype.icon="minus",o.prototype.htmlTag="hr",o.prototype._status=function(){},o.prototype.command=function(){return this.editor.editable.hr()},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/ImagePopover",["skylark-langx/langx","skylark-utils-dom/query","../Toolbar","../RichEditor","../Popover"],function(t,e,i,r,o){var n=o.inherit({});return n.prototype.offset={top:6,left:-4},n.prototype.render=function(){var t,i;return t='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("imageUrl")+'</label>\n    <input class="image-src" type="text" tabindex="1" />\n    <a class="btn-upload" href="javascript:;"\n      title="'+this._t("uploadImage")+'" tabindex="-1">\n      <span class="richeditor-icon richeditor-icon-upload"></span>\n    </a>\n  </div>\n  <div class=\'settings-field\'>\n    <label>'+this._t("imageAlt")+'</label>\n    <input class="image-alt" id="image-alt" type="text" tabindex="1" />\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("imageSize")+'</label>\n    <input class="image-size" id="image-width" type="text" tabindex="2" />\n    <span class="times">×</span>\n    <input class="image-size" id="image-height" type="text" tabindex="3" />\n    <a class="btn-restore" href="javascript:;"\n      title="'+this._t("restoreImageSize")+'" tabindex="-1">\n      <span class="richeditor-icon richeditor-icon-undo"></span>\n    </a>\n  </div>\n</div>',this.el.addClass("image-popover").append(t),this.srcEl=this.el.find(".image-src"),this.widthEl=this.el.find("#image-width"),this.heightEl=this.el.find("#image-height"),this.altEl=this.el.find("#image-alt"),this.srcEl.on("keydown",(i=this,function(t){var e;if(13===t.which&&!i.target.hasClass("uploading"))return t.preventDefault(),e=document.createRange(),i.button.editor.editable.selection.setRangeAfter(i.target,e),i.hide()})),this.srcEl.on("blur",function(t){return function(e){return t._loadImage(t.srcEl.val())}}(this)),this.el.find(".image-size").on("blur",function(t){return function(i){return t._resizeImg(e(i.currentTarget)),t.el.data("popover").refresh()}}(this)),this.el.find(".image-size").on("keyup",function(t){return function(i){var r;if(r=e(i.currentTarget),13!==i.which&&27!==i.which&&9!==i.which)return t._resizeImg(r,!0)}}(this)),this.el.find(".image-size").on("keydown",function(t){return function(i){var r,o,n;return o=e(i.currentTarget),13===i.which||27===i.which?(i.preventDefault(),13===i.which?t._resizeImg(o):t._restoreImg(),r=t.target,t.hide(),n=document.createRange(),t.button.editor.editable.selection.setRangeAfter(r,n)):9===i.which?t.el.data("popover").refresh():void 0}}(this)),this.altEl.on("keydown",function(t){return function(e){var i;if(13===e.which)return e.preventDefault(),i=document.createRange(),t.button.editor.editable.selection.setRangeAfter(t.target,i),t.hide()}}(this)),this.altEl.on("keyup",function(t){return function(e){if(13!==e.which&&27!==e.which&&9!==e.which)return t.alt=t.altEl.val(),t.target.attr("alt",t.alt)}}(this)),this.el.find(".btn-restore").on("click",function(t){return function(e){return t._restoreImg(),t.el.data("popover").refresh()}}(this)),this.editor.on("valuechanged",function(t){return function(e){if(t.active)return t.refresh()}}(this)),this._initUploader()},n.prototype._initUploader=function(){var t,i,r;if(t=this.el.find(".btn-upload"),null!=this.editor.uploader)return r=this,(i=function(){return r.input&&r.input.remove(),r.input=e("<input/>",{type:"file",title:r._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(t)})(),this.el.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),this.el.on("change","input[type=file]",function(t){return function(e){return t.editor.uploader.upload(t.input,{inline:!0,img:t.target}),i()}}(this));t.remove()},n.prototype._resizeImg=function(e,i){var r,o,n;if(null==i&&(i=!1),o=1*e.val(),this.target&&(t.isNumber(o)||o<0))return e.is(this.widthEl)?(n=o,r=this.height*o/this.width,this.heightEl.val(r)):(r=o,n=this.width*o/this.height,this.widthEl.val(n)),i?void 0:(this.target.attr({width:n,height:r}),this.editor.trigger("valuechanged"))},n.prototype._restoreImg=function(){var t,e;return e=(null!=(t=this.target.data("image-size"))?t.split(","):void 0)||[this.width,this.height],this.target.attr({width:1*e[0],height:1*e[1]}),this.widthEl.val(e[0]),this.heightEl.val(e[1]),this.editor.trigger("valuechanged")},n.prototype._loadImage=function(t,e){var i;if(!/^data:image/.test(t)||this.editor.uploader){if(this.target.attr("src")!==t)return this.button.loadImage(this.target,t,(i=this,function(r){var o;if(r)return i.active&&(i.width=r.width,i.height=r.height,i.widthEl.val(i.width),i.heightEl.val(i.height)),/^data:image/.test(t)?((o=i.editor.editable.util.dataURLtoBlob(t)).name="Base64 Image.png",i.editor.uploader.upload(o,{inline:!0,img:i.target})):i.editor.trigger("valuechanged"),e?e(r):void 0}))}else e&&e(!1)},n.prototype.show=function(){var t,e;return e=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],o.prototype.show.apply(this,e),t=this.target,this.width=t.width(),this.height=t.height(),this.alt=t.attr("alt"),t.hasClass("uploading")?this.srcEl.val(this._t("uploading")).prop("disabled",!0):(this.srcEl.val(t.attr("src")).prop("disabled",!1),this.widthEl.val(this.width),this.heightEl.val(this.height),this.altEl.val(this.alt))},n}),t("skylark-ui-rteditor/buttons/ImageButton",["skylark-langx/langx","skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","./ImagePopover"],function(t,e,i,r,o,n){var a=o.inherit({});return a.prototype.name="image",a.prototype.icon="picture-o",a.prototype.htmlTag="img",a.prototype.disableTag="pre, table",a.prototype.defaultImage="",a.prototype.needFocus=!1,a.prototype._init=function(){var t,i,r,n,a;if(this.editor.opts.imageButton)if(Array.isArray(this.editor.opts.imageButton))for(this.menu=[],n=this.editor.opts.imageButton,i=0,r=n.length;i<r;i++)t=n[i],this.menu.push({name:t+"-image",text:this._t(t+"Image")});else this.menu=!1;else null!=this.editor.uploader?this.menu=[{name:"upload-image",text:this._t("uploadImage")},{name:"external-image",text:this._t("externalImage")}]:this.menu=!1;return this.defaultImage=this.editor.opts.defaultImage,this.editor.body.on("click","img:not([data-non-image])",(a=this,function(t){var i,r;return i=e(t.currentTarget),(r=document.createRange()).selectNode(i[0]),a.editor.editable.selection.range(r),a.editor.editable.util.support.onselectionchange||a.editor.trigger("selectionchanged"),!1})),this.editor.body.on("mouseup","img:not([data-non-image])",function(t){return!1}),this.editor.on("selectionchanged.image",function(t){return function(){var i,r,o;if(null!=(o=t.editor.editable.selection.range()))return 1===(i=e(o.cloneContents()).contents()).length&&i.is("img:not([data-non-image])")?(r=e(o.startContainer).contents().eq(o.startOffset),t.popover.show(r)):t.popover.hide()}}(this)),this.editor.on("valuechanged.image",function(t){return function(){var i;if((i=t.editor.wrapper.find(".richeditor-image-loading")).length>0)return i.each(function(i,r){var o,n,a;if(n=e(r),!((o=n.data("img"))&&o.parent().length>0)&&(n.remove(),o&&(a=o.data("file"))&&(t.editor.uploader.cancel(a),t.editor.body.find("img.uploading").length<1)))return t.editor.uploader.trigger("uploadready",[a])})}}(this)),o.prototype._init.call(this)},a.prototype.render=function(){var t;if(t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],o.prototype.render.apply(this,t),this.popover=new n({button:this}),"upload"===this.editor.opts.imageButton)return this._initUploader(this.el)},a.prototype.renderMenu=function(){return o.prototype.renderMenu.call(this),this._initUploader()},a.prototype._initUploader=function(i){var r,o,n,a;if(null==i&&(i=this.menuEl.find(".menu-item-upload-image")),null!=this.editor.uploader)return r=null,a=this,(o=function(){return r&&r.remove(),r=e("<input/>",{type:"file",title:a._t("uploadImage"),multiple:!0,accept:"image/gif,image/jpeg,image/jpg,image/png,image/svg"}).appendTo(i)})(),i.on("click mousedown","input[type=file]",function(t){return t.stopPropagation()}),i.on("change","input[type=file]",function(t){return function(e){return t.editor.editable.inputManager.focused?(t.editor.uploader.upload(r,{inline:!0}),o()):(t.editor.one("focus",function(e){return t.editor.uploader.upload(r,{inline:!0}),o()}),t.editor.focus()),t.wrapper.removeClass("menu-on")}}(this)),this.editor.uploader.on("beforeupload",function(t){return function(i,r){var o;if(r.inline)return r.img?o=e(r.img):(o=t.createImage(r.name),r.img=o),o.addClass("uploading"),o.data("file",r),t.editor.uploader.readImageFile(r.obj,function(e){var i;if(o.hasClass("uploading"))return i=e?e.src:t.defaultImage,t.loadImage(o,i,function(){if(t.popover.active)return t.popover.refresh(),t.popover.srcEl.val(t._t("uploading")).prop("disabled",!0)})})}}(this)),n=t.proxy(this.editor.editable.util.throttle(function(t,e,i,r){var o,n,a;if(e.inline&&(n=e.img.data("mask"))){if((o=n.data("img")).hasClass("uploading")&&o.parent().length>0)return(a=(100*(a=i/r)).toFixed(0))>99&&(a=99),n.find(".progress").height(100-a+"%");n.remove()}},500),this),this.editor.uploader.on("uploadprogress",n),this.editor.uploader.on("uploadsuccess",function(t){return function(e,i,r){var o,n,a;if(i.inline&&(o=i.img).hasClass("uploading")&&o.parent().length>0){if("object"!=typeof r)try{r=JSON.parse(r)}catch(t){t,r={success:!1}}return!1===r.success?(a=r.msg||t._t("uploadFailed"),alert(a),n=t.defaultImage):n=r.file_path,t.loadImage(o,n,function(){var e;if(o.removeData("file"),o.removeClass("uploading").removeClass("loading"),(e=o.data("mask"))&&e.remove(),o.removeData("mask"),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1)return t.editor.uploader.trigger("uploadready",[i,r])}),t.popover.active?(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(r.file_path)):void 0}}}(this)),this.editor.uploader.on("uploaderror",function(t){return function(e,i,r){var o,n;if(i.inline&&"abort"!==r.statusText){if(r.responseText)try{n=JSON.parse(r.responseText),n.msg}catch(e){e,t._t("uploadError")}if((o=i.img).hasClass("uploading")&&o.parent().length>0)return t.loadImage(o,t.defaultImage,function(){var t;return o.removeData("file"),o.removeClass("uploading").removeClass("loading"),(t=o.data("mask"))&&t.remove(),o.removeData("mask")}),t.popover.active&&(t.popover.srcEl.prop("disabled",!1),t.popover.srcEl.val(t.defaultImage)),t.editor.trigger("valuechanged"),t.editor.body.find("img.uploading").length<1?t.editor.uploader.trigger("uploadready",[i,n]):void 0}}}(this));this.el.find(".btn-upload").remove()},a.prototype._status=function(){return this._disableStatus()},a.prototype.loadImage=function(i,r,o){var n,a,l,s;return s=this,l=function(){var t,e;return t=i.offset(),e=s.editor.wrapper.offset(),n.css({top:t.top-e.top,left:t.left-e.left,width:i.width(),height:i.height()}).show()},i.addClass("loading"),(n=i.data("mask"))||(n=e('<div class="richeditor-image-loading">\n  <div class="progress"></div>\n</div>').hide().appendTo(this.editor.wrapper),l(),i.data("mask",n),n.data("img",i)),(a=new Image).onload=function(e){return function(){var s,d;if(i.hasClass("loading")||i.hasClass("uploading"))return d=a.width,s=a.height,i.attr({src:r,width:d,height:s,"data-image-size":d+","+s}).removeClass("loading"),i.hasClass("uploading")?(e.editor.editable.util.reflow(e.editor.body),l()):(n.remove(),i.removeData("mask")),t.isFunction(o)?o(a):void 0}}(this),a.onerror=function(){return t.isFunction(o)&&o(!1),n.remove(),i.removeData("mask").removeClass("loading")},a.src=r},a.prototype.createImage=function(t){var i,r;return null==t&&(t="Image"),this.editor.editable.inputManager.focused||this.editor.focus(),(r=this.editor.editable.selection.range()).deleteContents(),this.editor.editable.selection.range(r),i=e("<img/>").attr("alt",t),r.insertNode(i[0]),this.editor.editable.selection.setRangeAfter(i,r),this.editor.trigger("valuechanged"),i},a.prototype.command=function(t){var e,i;return e=this.createImage(),this.loadImage(e,t||this.defaultImage,(i=this,function(){return i.editor.trigger("valuechanged"),i.editor.editable.util.reflow(e),e.click(),i.popover.one("popovershow",function(){return i.popover.srcEl.focus(),i.popover.srcEl[0].select()})}))},r.Toolbar.addButton(a),a}),t("skylark-ui-rteditor/buttons/IndentButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="indent",o.prototype.icon="indent",o.prototype._init=function(){var t;return t=!1===this.editor.opts.tabIndent?"":" (Tab)",this.title=this._t(this.name)+t,r.prototype._init.call(this)},o.prototype._status=function(){},o.prototype.command=function(){return this.editor.editable.indent()},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/ItalicButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="italic",o.prototype.icon="italic",o.prototype.htmlTag="i",o.prototype.disableTag="pre",o.prototype.shortcut="cmd+i",o.prototype._init=function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + i )":(this.title=this.title+" ( Ctrl + i )",this.shortcut="ctrl+i"),r.prototype._init.call(this)},o.prototype._activeStatus=function(){var t;return t=this.editor.editable.isActive("italic"),this.setActive(t),this.active},o.prototype.command=function(){return this.editor.editable.italic()},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/LinkPopover",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Popover"],function(t,e,i,r){var o=r.inherit({});return o.prototype.render=function(){var e,i;return e='<div class="link-settings">\n  <div class="settings-field">\n    <label>'+this._t("linkText")+'</label>\n    <input class="link-text" type="text"/>\n    <a class="btn-unlink" href="javascript:;" title="'+this._t("removeLink")+'"\n      tabindex="-1">\n      <span class="richeditor-icon richeditor-icon-unlink"></span>\n    </a>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkUrl")+'</label>\n    <input class="link-url" type="text"/>\n  </div>\n  <div class="settings-field">\n    <label>'+this._t("linkTarget")+'</label>\n    <select class="link-target">\n      <option value="_blank">'+this._t("openLinkInNewWindow")+' (_blank)</option>\n      <option value="_self">'+this._t("openLinkInCurrentWindow")+" (_self)</option>\n    </select>\n  </div>\n</div>",this.el.addClass("link-popover").append(e),this.textEl=this.el.find(".link-text"),this.urlEl=this.el.find(".link-url"),this.unlinkEl=this.el.find(".btn-unlink"),this.selectTarget=this.el.find(".link-target"),this.textEl.on("keyup",(i=this,function(t){if(13!==t.which)return i.target.text(i.textEl.val()),i.editor.editable.inputManager.throttledValueChanged()})),this.urlEl.on("keyup",function(t){return function(e){var i;if(13!==e.which)return i=t.urlEl.val(),!/^(http|https|ftp|ftps|file)?:\/\/|^(mailto|tel)?:|^\//gi.test(i)&&i&&(i="http://"+i),t.target.attr("href",i),t.editor.editable.inputManager.throttledValueChanged()}}(this)),t([this.urlEl[0],this.textEl[0]]).on("keydown",function(e){return function(i){var r;if(13===i.which||27===i.which||!i.shiftKey&&9===i.which&&t(i.target).hasClass("link-url"))return i.preventDefault(),r=document.createRange(),e.editor.editable.selection.setRangeAfter(e.target,r),e.hide(),e.editor.editable.inputManager.throttledValueChanged()}}(this)),this.unlinkEl.on("click",function(t){return function(e){var i,r;return r=document.createTextNode(t.target.text()),t.target.replaceWith(r),t.hide(),i=document.createRange(),t.editor.editable.selection.setRangeAfter(r,i),t.editor.editable.inputManager.throttledValueChanged()}}(this)),this.selectTarget.on("change",function(t){return function(e){return t.target.attr("target",t.selectTarget.val()),t.editor.editable.inputManager.throttledValueChanged()}}(this))},o.prototype.show=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],r.prototype.show.apply(this,t),this.textEl.val(this.target.text()),this.urlEl.val(this.target.attr("href"))},o}),t("skylark-ui-rteditor/buttons/LinkButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","../i18n","./LinkPopover"],function(t,e,i,r,o,n){var a=r.inherit({});return a.prototype.name="link",a.prototype.icon="link",a.prototype.htmlTag="a",a.prototype.disableTag="pre",a.prototype.render=function(){var t;return t=1<=arguments.length?Array.prototype.slice.call(arguments,0):[],r.prototype.render.apply(this,t),this.popover=new n({button:this})},a.prototype._status=function(){return r.prototype._status.call(this),this.active&&!this.editor.editable.selection.rangeAtEndOf(this.node)?this.popover.show(this.node):this.popover.hide()},a.prototype.command=function(){var t;return this.active&&this.popover.one("popovershow",(t=this,function(){return linkText?(t.popover.urlEl.focus(),t.popover.urlEl[0].select()):(t.popover.textEl.focus(),t.popover.textEl[0].select())})),this.editor.editable.link(this.active,o.translate("linkText"))},i.Toolbar.addButton(a),a}),t("skylark-ui-rteditor/buttons/ListButton",["skylark-utils-dom/noder","skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r,o){var n=o.inherit({});return n.prototype.type="",n.prototype.disableTag="pre, table",n.prototype.command=function(t){return this.editor.editable.list(this.type,t,this.disableTag)},n}),t("skylark-ui-rteditor/buttons/OrderListButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","./ListButton"],function(t,e,i,r){var o=r.inherit({});return o.prototype.type="ol",o.prototype.name="ol",o.prototype.icon="list-ol",o.prototype.htmlTag="ol",o.prototype.shortcut="cmd+/",o.prototype._init=function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + / )":(this.title=this.title+" ( ctrl + / )",this.shortcut="ctrl+/"),r.prototype._init.call(this)},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/OutdentButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="outdent",o.prototype.icon="outdent",o.prototype._init=function(){var t;return t=!1===this.editor.opts.tabIndent?"":" (Shift + Tab)",this.title=this._t(this.name)+t,r.prototype._init.call(this)},o.prototype._status=function(){},o.prototype.command=function(){return this.editor.editable.outdent()},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/StrikethroughButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="strikethrough",o.prototype.icon="strikethrough",o.prototype.htmlTag="strike",o.prototype.disableTag="pre",o.prototype._activeStatus=function(){var t;return t=this.editor.editable.isActive("strikethrough"),this.setActive(t),this.active},o.prototype.command=function(){return this.editor.editable.strikethrough()},i.Toolbar.addButton(o),o}),t("skylark-utils-dom/tables",["./dom","./langx","./query"],function(t,e,i){function r(){return r}function o(t,e){return t.find("td, th").each(function(t,r){var o;return(o=i(r)).replaceWith("<"+e+">"+o.html()+"</"+e+">")})}function n(t,e){var r,o,n=i(t);o=n.closest(".simditor-table"),r=o.next("p"),o.remove(),e&&e(r)}function a(t){return setTimeout(function(){var e,r;return r=t.width(),e=t.find("col"),t.find("thead tr th").each(function(t,o){return e.eq(t).attr("width",i(o).outerWidth()/r*100+"%")})},0)}function l(t){var e=i(t);if(e.parent(".simditor-table").length>0)return e.parent().replaceWith(e)[0]}return e.mixin(r,{createTable:function(t,e,r){var o,n,a,l,s,d,u,p,h,c;for(o=i("<table/>"),l=i("<thead/>").appendTo(o),n=i("<tbody/>").appendTo(o),p=d=0,h=t;0<=h?d<h:d>h;p=0<=h?++d:--d)for((s=i("<tr/>")).appendTo(0===p?l:n),u=0,c=e;0<=c?u<c:u>c;0<=c?++u:--u)a=i(0===p?"<th/>":"<td/>").appendTo(s),r&&a.append(r);return o[0]},decorate:function(t,e){var r,n,s,d,u,p=i(t);p.parent("."+e.tableDecorate).length>0&&l(t);p.wrap('<div class="'+e.tableDecorate+'"></div>'),u=p.parent("."+e.tableDecorate),r=p.find("colgroup"),p.find("thead").length<1&&(d=i("<thead />"),n=p.find("tr").first(),d.append(n),o(n,"th"),(s=p.find("tbody")).length>0?s.before(d):p.prepend(d));r.length<1&&(r=i("<colgroup/>").prependTo(p),p.find("thead tr th").each(function(t,e){return i("<col/>").appendTo(r)}),a(p));return i("<div />",{class:e.resizeHandle,contenteditable:"false"}).appendTo(u),p.parent()},deleteCol:function(t,e){var r,o,l,s,d,u,p=i(t);if(l=p.parent("tr"),u=l.closest("table").find("tr").length<2,d=p.siblings("td, th").length<1,u&&d)return n(t);s=l.find("td, th").index(p),(r=p.next("td, th")).length>0||(r=l.prev("td, th")),(o=l.closest("table")).find("col").eq(s).remove(),o.find("tr").each(function(t,e){return i(e).find("td, th").eq(s).remove()}),a(o),e&&e(r[0])},deleteRow:function(t,e){var r,a,l,s=i(t);if((a=s.parent("tr")).closest("table").find("tr").length<1)return n(t);(r=function(t){var e;(e=t.next("tr")).length<1&&t.parent("thead").length>0&&(e=t.parent("thead").next("tbody").find("tr:first"));return e}(a)).length>0||(r=function(t){var e;(e=t.prev("tr")).length<1&&t.parent("tbody").length>0&&(e=t.parent("tbody").prev("thead").find("tr"));return e}(a)),l=a.find("td, th").index(s),a.parent().is("thead")&&(r.appendTo(a.parent()),o(r,"th")),a.remove(),e&&e(r[0],l)},deleteTable:n,insertCol:function(t,e,r,o){var n,l,s,d,u,p,h,c,f=i(t);null==e&&(e="after");u=f.parent("tr"),p=u.find("td, th").index(f),d=f.closest("table"),n=d.find("col").eq(p),d.find("tr").each(function(t,o){var n,a;return a=i(o).parent().is("thead")?"th":"td",n=i("<"+a+"/>").append(r),i(o).find("td, th").eq(p)[e](n)}),l=i("<col/>"),n[e](l),h=d.width(),c=Math.max(parseFloat(n.attr("width"))/2,50/h*100),n.attr("width",c+"%"),l.attr("width",c+"%"),a(d),s="after"===e?f.next("td, th"):f.prev("td, th"),o&&o(s[0])},insertRow:function(t,e,r,n){var a,l,s,d,u,p,h,c,f=i(t);null==e&&(e="after");s=f.parent("tr"),l=s.closest("table"),u=0,l.find("tr").each(function(t,e){return u=Math.max(u,i(e).find("td").length)}),p=s.find("td, th").index(f),a=i("<tr/>"),d="td","after"===e&&s.parent().is("thead")?s.parent().next("tbody").prepend(a):"before"===e&&s.parent().is("thead")?(s.before(a),s.parent().next("tbody").prepend(s),o(s,"td"),d="th"):s[e](a);for(h=1,c=u;1<=c?h<=c:h>=c;1<=c?++h:--h)i("<"+d+"/>").append(r).appendTo(a);n&&n(a[0],p)},refreshTableWidth:a,resizable:function(t,e){var r=e.cssClasses,o=r.resizeHandle,n="."+r.wrapper,a="."+o;return i(t).on("mousemove.table",n+" td, "+n+" th",function(t){var e,r,o,l,s,d,u,p;if(o=(s=i(this).parents(n)).find(a),r=s.find("colgroup"),!s.hasClass("resizing"))if(l=i(t.currentTarget),t.pageX-i(t.currentTarget).offset().left<5&&l.prev().length>0&&(l=l.prev()),l.next("td, th").length<1)o.hide();else if(null!=(u=o.data("td"))&&u.is(l))o.show();else{if(d=l.parent().find("td, th").index(l),e=r.find("col").eq(d),null==(p=o.data("col"))||!p.is(e))return o.css("left",l.position().left+l.outerWidth()-5).data("td",l).data("col",e).show();o.show()}}),i(t).on("mouseleave"+n,n,function(t){return i(this).find(a).hide()}),i(t).on("mousedown"+a,a,function(e){var r,o,a,l,s,d,u,p,h,c,f;return d=i(this).parent(n),a=(r=i(e.currentTarget)).data("td"),o=r.data("col"),s=a.next("td, th"),l=o.next("col"),c=e.pageX,p=1*a.outerWidth(),h=1*s.outerWidth(),u=parseFloat(r.css("left")),f=a.closest(n).width(),i(t).on("mousemove.resize-table",function(t){var e,i,n;return e=t.pageX-c,n=h-e,(i=p+e)<50?(i=50,n=h-(e=50-p)):n<50&&(n=50,i=p+(e=h-50)),o.attr("width",i/f*100+"%"),l.attr("width",n/f*100+"%"),r.css("left",u+e)}),i(t).one("mouseup.resize-table",function(e){return i(t).off(".resize-table"),d.removeClass("resizing")}),d.addClass("resizing"),!1})},undecorate:l}),t.tables=r}),t("skylark-ui-rteditor/buttons/TableButton",["skylark-langx/langx","skylark-utils-dom/tables","skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r,o,n){var a=n.inherit({});return a.prototype.name="table",a.prototype.icon="table",a.prototype.htmlTag="table",a.prototype.disableTag="pre, li, blockquote",a.prototype.menu=!0,a.prototype._init=function(){var e;return n.prototype._init.call(this),t.merge(this.editor.editable.formatter._allowedTags,["thead","th","tbody","tr","td","colgroup","col"]),t.extend(this.editor.editable.formatter._allowedAttributes,{td:["rowspan","colspan"],col:["width"]}),t.extend(this.editor.editable.formatter._allowedStyles,{td:["text-align"],th:["text-align"]}),this._initShortcuts(),this._initResize(),this.editor.on("decorate",(e=this,function(t,r){return r.find("table").each(function(t,r){return e.decorate(i(r))})})),this.editor.on("undecorate",function(t){return function(e,r){return r.find("table").each(function(e,r){return t.undecorate(i(r))})}}(this)),this.editor.on("selectionchanged.table",function(t){return function(e){var i,r;if(t.editor.body.find(".richeditor-table td, .richeditor-table th").removeClass("active"),r=t.editor.editable.selection.range())return i=t.editor.editable.selection.containerNode(),r.collapsed&&i.is(".richeditor-table")&&t.editor.editable.selection.setRangeAtEndOf(i),i.closest("td, th",t.editor.body).addClass("active")}}(this)),this.editor.on("blur.table",function(t){return function(e){return t.editor.body.find(".richeditor-table td, .richeditor-table th").removeClass("active")}}(this)),this.editor.editable.keystroke.add("up","td",function(t){return function(e,i){return t._tdNav(i,"up"),!0}}(this)),this.editor.editable.keystroke.add("up","th",function(t){return function(e,i){return t._tdNav(i,"up"),!0}}(this)),this.editor.editable.keystroke.add("down","td",function(t){return function(e,i){return t._tdNav(i,"down"),!0}}(this)),this.editor.editable.keystroke.add("down","th",function(t){return function(e,i){return t._tdNav(i,"down"),!0}}(this))},a.prototype._tdNav=function(t,e){var i,r,o,n,a;return null==e&&(e="up"),o="up"===e?"prev":"next",(a="up"===e?["tbody","thead"]:["thead","tbody"])[0],a[1],r=t.parent("tr"),!((i=this["_"+o+"Row"](r)).length>0)||(n=r.find("td, th").index(t),this.editor.editable.selection.setRangeAtEndOf(i.find("td, th").eq(n)))},a.prototype._initResize=function(){e.resizable(document,{cssClasses:{resizeHandle:"richeditor-resize-handle",wrapper:"richeditor-table"}})},a.prototype._initShortcuts=function(){var t;return this.editor.editable.hotkeys.add("ctrl+alt+up",(t=this,function(e){return t.editMenu.find(".menu-item[data-param=insertRowAbove]").click(),!1})),this.editor.editable.hotkeys.add("ctrl+alt+down",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertRowBelow]").click(),!1}}(this)),this.editor.editable.hotkeys.add("ctrl+alt+left",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColLeft]").click(),!1}}(this)),this.editor.editable.hotkeys.add("ctrl+alt+right",function(t){return function(e){return t.editMenu.find(".menu-item[data-param=insertColRight]").click(),!1}}(this))},a.prototype.renderMenu=function(){var t,e;return i('<div class="menu-create-table">\n</div>\n<div class="menu-edit-table">\n  <ul>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteRow">\n        <span>'+this._t("deleteRow")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowAbove">\n        <span>'+this._t("insertRowAbove")+' ( Ctrl + Alt + ↑ )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertRowBelow">\n        <span>'+this._t("insertRowBelow")+' ( Ctrl + Alt + ↓ )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteCol">\n        <span>'+this._t("deleteColumn")+'</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColLeft">\n        <span>'+this._t("insertColumnLeft")+' ( Ctrl + Alt + ← )</span>\n      </a>\n    </li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="insertColRight">\n        <span>'+this._t("insertColumnRight")+' ( Ctrl + Alt + → )</span>\n      </a>\n    </li>\n    <li><span class="separator"></span></li>\n    <li>\n      <a tabindex="-1" unselectable="on" class="menu-item"\n        href="javascript:;" data-param="deleteTable">\n        <span>'+this._t("deleteTable")+"</span>\n      </a>\n    </li>\n  </ul>\n</div>").appendTo(this.menuWrapper),this.createMenu=this.menuWrapper.find(".menu-create-table"),this.editMenu=this.menuWrapper.find(".menu-edit-table"),t=this.createTable(6,6).appendTo(this.createMenu),this.createMenu.on("mouseenter","td, th",(e=this,function(r){var o,n,a,l;return e.createMenu.find("td, th").removeClass("selected"),o=i(r.currentTarget),n=o.parent(),l=n.find("td, th").index(o)+1,a=n.prevAll("tr").addBack(),n.parent().is("tbody")&&(a=a.add(t.find("thead tr"))),a.find("td:lt("+l+"), th:lt("+l+")").addClass("selected")})),this.createMenu.on("mouseleave",function(t){return i(t.currentTarget).find("td, th").removeClass("selected")}),this.createMenu.on("mousedown","td, th",function(e){return function(r){var o,n,a,l,s;if(e.wrapper.removeClass("menu-on"),e.editor.editable.inputManager.focused)return n=i(r.currentTarget),a=n.parent(),l=a.find("td").index(n)+1,s=a.prevAll("tr").length+1,a.parent().is("tbody")&&(s+=1),t=e.createTable(s,l,!0),o=e.editor.editable.selection.blockNodes().last(),e.editor.editable.util.isEmptyNode(o)?o.replaceWith(t):o.after(t),e.decorate(t),e.editor.editable.selection.setRangeAtStartOf(t.find("th:first")),e.editor.trigger("valuechanged"),!1}}(this))},a.prototype.decorate=function(t){return i(e.decorate(t[0],{tableDecorate:"richeditor-table",resizeHandle:"richeditor-resize-handle"}))},a.prototype.undecorate=function(t){return i(e.undecorate(t[0],{tableDecorate:"richeditor-table",resizeHandle:"richeditor-resize-handle"}))},a.prototype.createTable=function(t,r,o){return i(e.createTable(t,r,o?this.editor.editable.util.phBr:null))},a.prototype.refreshTableWidth=function(t){return table.refreshTableWidth(t[0])},a.prototype.setActive=function(t){return n.prototype.setActive.call(this,t),t?(this.createMenu.hide(),this.editMenu.show()):(this.createMenu.show(),this.editMenu.hide())},a.prototype.deleteRow=function(t){var r,o=this;return e.deleteRow(t[0],function(t,e){t&&(r=o.editor.editable.selection.setRangeAtEndOf(i(t).find("td, th").eq(e)))}),r},a.prototype.insertRow=function(t,r){var o,n=this;return e.insertRow(t[0],r,n.editor.editable.util.phBr,function(t,e){o=n.editor.editable.selection.setRangeAtStartOf(i(t).find("td, th").eq(e))}),o},a.prototype.deleteCol=function(t){var r,o=this;return e.deleteCol(t[0],function(t){t&&(r=o.editor.editable.selection.setRangeAtEndOf(i(t)))}),r},a.prototype.insertCol=function(t,r){var o,n=this;return e.insertCol(t[0],r,n.editor.editable.util.phBr,function(t){o=n.editor.editable.selection.setRangeAtStartOf(i(t))}),o},a.prototype.deleteTable=function(t){var i=this;e.deleteTable(t[0],function(t){if(t.length>0)return i.editor.editable.selection.setRangeAtStartOf(t)})},a.prototype.command=function(t){var e;if((e=this.editor.editable.selection.containerNode().closest("td, th")).length>0){if("deleteRow"===t)this.deleteRow(e);else if("insertRowAbove"===t)this.insertRow(e,"before");else if("insertRowBelow"===t)this.insertRow(e);else if("deleteCol"===t)this.deleteCol(e);else if("insertColLeft"===t)this.insertCol(e,"before");else if("insertColRight"===t)this.insertCol(e);else{if("deleteTable"!==t)return;this.deleteTable(e)}return this.editor.trigger("valuechanged")}},o.Toolbar.addButton(a),a}),t("skylark-ui-rteditor/buttons/TitleButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button","../i18n"],function(t,e,i,r,o){var n=r.inherit({});return n.prototype.name="title",n.prototype.htmlTag="h1, h2, h3, h4, h5",n.prototype.disableTag="pre, table",n.prototype._init=function(){return this.menu=[{name:"normal",text:o.translate("normalText"),param:"p"},"|",{name:"h1",text:o.translate("title")+" 1",param:"h1"},{name:"h2",text:o.translate("title")+" 2",param:"h2"},{name:"h3",text:o.translate("title")+" 3",param:"h3"},{name:"h4",text:o.translate("title")+" 4",param:"h4"},{name:"h5",text:o.translate("title")+" 5",param:"h5"}],r.prototype._init.call(this)},n.prototype.setActive=function(t,e){if(r.prototype.setActive.call(this,t),t&&(e||(e=this.node[0].tagName.toLowerCase())),this.el.removeClass("active-p active-h1 active-h2 active-h3 active-h4 active-h5"),t)return this.el.addClass("active active-"+e)},n.prototype.command=function(t){return this.editor.editable.title(t,this.disableTag)},i.Toolbar.addButton(n),n}),t("skylark-ui-rteditor/buttons/UnderlineButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","../Button"],function(t,e,i,r){var o=r.inherit({});return o.prototype.name="underline",o.prototype.icon="underline",o.prototype.htmlTag="u",o.prototype.disableTag="pre",o.prototype.shortcut="cmd+u",o.prototype.render=function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + u )":(this.title=this.title+" ( Ctrl + u )",this.shortcut="ctrl+u"),r.prototype.render.call(this)},o.prototype._activeStatus=function(){var t;return t=this.editor.editable.isActive("underline"),this.setActive(t),this.active},o.prototype.command=function(){return this.editor.editable.underline()},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/buttons/UnorderListButton",["skylark-utils-dom/query","../Toolbar","../RichEditor","./ListButton"],function(t,e,i,r){var o=r.inherit({});return o.prototype.type="ul",o.prototype.name="ul",o.prototype.icon="list-ul",o.prototype.htmlTag="ul",o.prototype.shortcut="cmd+.",o.prototype._init=function(){return this.editor.editable.util.os.mac?this.title=this.title+" ( Cmd + . )":(this.title=this.title+" ( Ctrl + . )",this.shortcut="ctrl+."),r.prototype._init.call(this)},i.Toolbar.addButton(o),o}),t("skylark-ui-rteditor/main",["./RichEditor","./Button","./Popover","./buttons/AlignmentButton","./buttons/BlockquoteButton","./buttons/BoldButton","./buttons/CodeButton","./buttons/CodePopover","./buttons/ColorButton","./buttons/FontScaleButton","./buttons/HrButton","./buttons/ImageButton","./buttons/ImagePopover","./buttons/IndentButton","./buttons/ItalicButton","./buttons/LinkButton","./buttons/LinkPopover","./buttons/ListButton","./buttons/OrderListButton","./buttons/OutdentButton","./buttons/StrikethroughButton","./buttons/TableButton","./buttons/TitleButton","./buttons/UnderlineButton","./buttons/UnorderListButton"],function(t){return t}),t("skylark-ui-rteditor",["skylark-ui-rteditor/main"],function(t){return t})}(i),!o){var l=r("skylark-langx/skylark");n?module.exports=l:e.skylarkjs=l}}(0,this);
//# sourceMappingURL=sourcemaps/skylark-ui-rteditor.js.map
