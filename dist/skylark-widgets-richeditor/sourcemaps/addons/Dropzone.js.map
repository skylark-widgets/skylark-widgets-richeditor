{"version":3,"sources":["addons/Dropzone.js"],"names":["define","$","Addon","Toolbar","RichEditor","Button","i18n","Dropzone","inherit","categoryName","addonName","prototype","_entered","_init","this","editor","_widget","uploader","Error","document","body","on","e","originalEvent","dataTransfer","dropEffect","preventDefault","imageBtn","toolbar","findButton","stopPropagation","_this","show","hide","file","imageFiles","_i","_j","_len","_len1","_ref","files","length","validFile","alert","name","push","upload","inline","setActive","type","indexOf","addons","general","dropzone"],"mappings":";;;;;;;AAAAA,QACE,qBACA,6BACA,aACA,gBACA,YACA,WACA,SAASC,EAAEC,EAAOC,EAAQC,EAAWC,EAAOC,GAG5C,IAAIC,EAAWL,EAAMM,YAoFrB,OAjFAD,EAASE,aAAe,WAExBF,EAASG,UAAY,WAGrBH,EAASI,UAAUC,SAAW,EAE9BL,EAASI,UAAUE,MAAQ,WAEzB,GADAC,KAAKC,OAASD,KAAKE,QACS,MAAxBF,KAAKC,OAAOE,SACd,MAAM,IAAIC,MAAM,+CAWlB,OARAjB,EAAEkB,SAASC,MAAMC,GAAG,WAAY,SAASC,GAEvC,OADAA,EAAEC,cAAcC,aAAaC,WAAa,OACnCH,EAAEI,mBAEXzB,EAAEkB,SAASC,MAAMC,GAAG,OAAQ,SAASC,GACnC,OAAOA,EAAEI,mBAEXZ,KAAKa,SAAWb,KAAKC,OAAOa,QAAQC,WAAW,SACxCf,KAAKC,OAAOK,KAAKC,GAAG,WAAY,SAASC,GAG9C,OAFAA,EAAEC,cAAcC,aAAaC,WAAa,OAC1CH,EAAEQ,kBACKR,EAAEI,mBACRL,GAAG,aAAuBU,EAQ1BjB,KAPM,SAASQ,GAKd,OAJ8B,KAAzBS,EAAMnB,UAAY,IACrBmB,EAAMC,OAERV,EAAEI,iBACKJ,EAAEQ,qBAEHT,GAAG,YAAa,SAAUU,GAClC,OAAO,SAAST,GAKd,OAJKS,EAAMnB,UAAY,IAAM,GAC3BmB,EAAME,OAERX,EAAEI,iBACKJ,EAAEQ,mBANa,CAQvBhB,OAAOO,GAAG,OAAQ,SAAUU,GAC7B,OAAO,SAAST,GACd,IAAIY,EAAMC,EAAYC,EAAIC,EAAIC,EAAMC,EAAOC,EAG3C,IAFAL,KAEKC,EAAK,EAAGE,GADbE,EAAOlB,EAAEC,cAAcC,aAAaiB,OACXC,OAAQN,EAAKE,EAAMF,IAAM,CAEhD,GADAF,EAAOM,EAAKJ,IACPL,EAAMY,UAAUT,GAGnB,OAFAU,MAAM,IAAMV,EAAKW,KAAO,aACxBd,EAAME,QACC,EAETE,EAAWW,KAAKZ,GAElB,IAAKG,EAAK,EAAGE,EAAQJ,EAAWO,OAAQL,EAAKE,EAAOF,IAClDH,EAAOC,EAAWE,GAClBN,EAAMhB,OAAOE,SAAS8B,OAAOb,GAC3Bc,QAAQ,IAKZ,OAFAjB,EAAME,OACNX,EAAEQ,kBACKR,EAAEI,kBAtBQ,CAwBlBZ,OAxCgB,IAAUiB,GA2C/BxB,EAASI,UAAUqB,KAAO,WACxB,OAAOlB,KAAKa,SAASsB,WAAU,IAGjC1C,EAASI,UAAUsB,KAAO,WAExB,OADAnB,KAAKa,SAASsB,WAAU,GACjBnC,KAAKF,SAAW,GAGzBL,EAASI,UAAUgC,UAAY,SAAST,GACtC,OAAOA,EAAKgB,KAAKC,QAAQ,WAAa,GAGjC/C,EAAWgD,OAAOC,QAAQC,SAAW/C","file":"../../addons/Dropzone.js","sourcesContent":["define([\r\n  \"skylark-domx-query\",\r\n  \"skylark-widgets-base/Addon\",\r\n  \"../Toolbar\",\r\n  \"../RichEditor\",\r\n  \"../Button\",\r\n  \"../i18n\"\r\n],function($,Addon, Toolbar,RichEditor,Button,i18n){ \r\n\r\n\r\n  var Dropzone = Addon.inherit({\r\n  });\r\n\r\n  Dropzone.categoryName = \"genernal\";\r\n\r\n  Dropzone.addonName = \"dropzone\";\r\n\r\n\r\n  Dropzone.prototype._entered = 0;\r\n\r\n  Dropzone.prototype._init = function() {\r\n    this.editor = this._widget;\r\n    if (this.editor.uploader == null) {\r\n      throw new Error(\"Can't work without 'simple-uploader' module\");\r\n      return;\r\n    }\r\n    $(document.body).on(\"dragover\", function(e) {\r\n      e.originalEvent.dataTransfer.dropEffect = \"none\";\r\n      return e.preventDefault();\r\n    });\r\n    $(document.body).on('drop', function(e) {\r\n      return e.preventDefault();\r\n    });\r\n    this.imageBtn = this.editor.toolbar.findButton(\"image\");\r\n    return this.editor.body.on(\"dragover\", function(e) {\r\n      e.originalEvent.dataTransfer.dropEffect = \"copy\";\r\n      e.stopPropagation();\r\n      return e.preventDefault();\r\n    }).on(\"dragenter\", (function(_this) {\r\n      return function(e) {\r\n        if ((_this._entered += 1) === 1) {\r\n          _this.show();\r\n        }\r\n        e.preventDefault();\r\n        return e.stopPropagation();\r\n      };\r\n    })(this)).on(\"dragleave\", (function(_this) {\r\n      return function(e) {\r\n        if ((_this._entered -= 1) <= 0) {\r\n          _this.hide();\r\n        }\r\n        e.preventDefault();\r\n        return e.stopPropagation();\r\n      };\r\n    })(this)).on(\"drop\", (function(_this) {\r\n      return function(e) {\r\n        var file, imageFiles, _i, _j, _len, _len1, _ref;\r\n        imageFiles = [];\r\n        _ref = e.originalEvent.dataTransfer.files;\r\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n          file = _ref[_i];\r\n          if (!_this.validFile(file)) {\r\n            alert(\"「\" + file.name + \"]」文件不是图片。\");\r\n            _this.hide();\r\n            return false;\r\n          }\r\n          imageFiles.push(file);\r\n        }\r\n        for (_j = 0, _len1 = imageFiles.length; _j < _len1; _j++) {\r\n          file = imageFiles[_j];\r\n          _this.editor.uploader.upload(file, {\r\n            inline: true\r\n          });\r\n        }\r\n        _this.hide();\r\n        e.stopPropagation();\r\n        return e.preventDefault();\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  Dropzone.prototype.show = function() {\r\n    return this.imageBtn.setActive(true);\r\n  };\r\n\r\n  Dropzone.prototype.hide = function() {\r\n    this.imageBtn.setActive(false);\r\n    return this._entered = 0;\r\n  };\r\n\r\n  Dropzone.prototype.validFile = function(file) {\r\n    return file.type.indexOf(\"image/\") > -1;\r\n  };\r\n\r\n  return RichEditor.addons.general.dropzone = Dropzone;\r\n\r\n\r\n});"]}