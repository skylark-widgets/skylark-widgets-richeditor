/**
 * skylark-widgets-richeditor - The skylark richeditor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-richeditor/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-utils-dom/query","skylark-widgets-base/Action","./RichEditor","./i18n"],function(t,e,i,n,o){i.inherit({htmlTag:{get:function(){return this._options.htmlTag}},disableTag:{get:function(){return this._options.disableTag}},menu:{get:function(){return this._options.menu}},editable:{get:function(){return this._options.editable}},active:{get:function(){return this._options.active}},init:function(t){this.toolbar=t.toolbar,this.editor=t.toolbar.editor,this.title=o.translate(this.name),this._init()}});return Button.prototype._tpl={item:'<li><a tabindex="-1" unselectable="on" class="toolbar-item" href="javascript:;"><span></span></a></li>',menuWrapper:'<div class="toolbar-menu"></div>',menuItem:'<li><a tabindex="-1" unselectable="on" class="menu-item" href="javascript:;"><span></span></a></li>',separator:'<li><span class="separator"></span></li>'},Button.prototype.name="",Button.prototype.icon="",Button.prototype.title="",Button.prototype.text="",Button.prototype.htmlTag="",Button.prototype.disableTag="",Button.prototype.menu=!1,Button.prototype.active=!1,Button.prototype.disabled=!1,Button.prototype.needFocus=!0,Button.prototype.shortcut=null,Button.prototype._init=function(){var i,n,o,s,r;for(this.render(),this.el.on("mousedown",(r=this,function(t){var e,i;return t.preventDefault(),e=r.needFocus&&!r.editor.editable.inputManager.focused,!r.el.hasClass("disabled")&&(e&&r.editor.focus(),r.menu?(r.wrapper.toggleClass("menu-on").siblings("li").removeClass("menu-on"),r.wrapper.is(".menu-on")&&(r.menuWrapper.offset().left+r.menuWrapper.outerWidth()+5-r.editor.wrapper.offset().left-r.editor.wrapper.outerWidth()>0&&r.menuWrapper.css({left:"auto",right:0}),r.trigger("menuexpand")),!1):(i=r.el.data("param"),r.command(i),!1))})),this.wrapper.on("click","a.menu-item",function(t){return function(i){var n,o,s;return i.preventDefault(),n=e(i.currentTarget),t.wrapper.removeClass("menu-on"),o=t.needFocus&&!t.editor.editable.inputManager.focused,!n.hasClass("disabled")&&!o&&(t.toolbar.wrapper.removeClass("menu-on"),s=n.data("param"),t.command(s),!1)}}(this)),this.wrapper.on("mousedown","a.menu-item",function(t){return!1}),this.editor.on("blur",function(t){return function(){if(t.editor.body.is(":visible")&&t.editor.body.is("[contenteditable]")&&!t.editor.editable.clipboard.pasting)return t.setActive(!1),t.setDisabled(!1)}}(this)),null!=this.shortcut&&this.editor.editable.hotkeys.add(this.shortcut,function(t){return function(e){return t.el.mousedown(),!1}}(this)),i=0,n=(o=this.htmlTag.split(",")).length;i<n;i++)s=o[i],(s=t.trim(s))&&t.inArray(s,this.editor.editable.formatter._allowedTags)<0&&this.editor.editable.formatter._allowedTags.push(s);return this.editor.on("selectionchanged",function(t){return function(e){if(t.editor.editable.inputManager.focused)return t._status()}}(this))},Button.prototype.iconClassOf=function(t){return t?"richeditor-icon richeditor-icon-"+t:""},Button.prototype.setIcon=function(t){return this.el.find("span").removeClass().addClass(this.iconClassOf(t)).text(this.text)},Button.prototype.render=function(){if(this.wrapper=e(this._tpl.item).appendTo(this.toolbar.list),this.el=this.wrapper.find("a.toolbar-item"),this.el.attr("title",this.title).addClass("toolbar-item-"+this.name).data("button",this),this.setIcon(this.icon),this.menu)return this.menuWrapper=e(this._tpl.menuWrapper).appendTo(this.wrapper),this.menuWrapper.addClass("toolbar-menu-"+this.name),this.renderMenu()},Button.prototype.renderMenu=function(){var i,n,o,s,r,a,u;if(t.isArray(this.menu)){for(this.menuEl=e("<ul/>").appendTo(this.menuWrapper),u=[],n=0,o=(r=this.menu).length;n<o;n++)"|"!==(s=r[n])?(i=e(this._tpl.menuItem).appendTo(this.menuEl).find("a.menu-item").attr({title:null!=(a=s.title)?a:s.text,"data-param":s.param}).addClass("menu-item-"+s.name),s.icon?u.push(i.find("span").addClass(this.iconClassOf(s.icon))):u.push(i.find("span").text(s.text))):e(this._tpl.separator).appendTo(this.menuEl);return u}},Button.prototype.setActive=function(t){if(t!==this.active)return this.active=t,this.el.toggleClass("active",this.active)},Button.prototype.setDisabled=function(t){if(t!==this.disabled)return this.disabled=t,this.el.toggleClass("disabled",this.disabled)},Button.prototype._disableStatus=function(){var t,e,i;return i=this.editor.editable.selection.startNodes(),e=this.editor.editable.selection.endNodes(),t=i.filter(this.disableTag).length>0||e.filter(this.disableTag).length>0,this.setDisabled(t),this.disabled&&this.setActive(!1),this.disabled},Button.prototype._activeStatus=function(){var t,e,i,n,o;return o=this.editor.editable.selection.startNodes(),i=this.editor.editable.selection.endNodes(),n=o.filter(this.htmlTag),e=i.filter(this.htmlTag),t=n.length>0&&e.length>0&&n.is(e),this.node=t?n:null,this.setActive(t),this.active},Button.prototype._status=function(){if(this._disableStatus(),!this.disabled)return this._activeStatus()},Button.prototype.command=function(t){},Button.prototype._t=o.translate,n.Button=Button,Button});
//# sourceMappingURL=sourcemaps/Action.js.map
