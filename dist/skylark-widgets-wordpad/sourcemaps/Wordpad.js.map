{"version":3,"sources":["Wordpad.js"],"names":["define","skylark","langx","$","Editable","Widget","Toolbar","uploader","i18n","addons","Wordpad","inherit","options","classes","icons","html","header","bold","italic","underline","strike","fontSize","fontColor","mark","blockquote","listul","listol","code","table","fullscreen","emoji","link","image","video","indent","dedent","alignLeft","alignCenter","alignRight","alignJustify","srcNodeRef","placeholder","defaultImage","params","upload","template","_init","editor","uploadOpts","this","_actions","opts","textarea","attr","length","Error","data","destroy","id","count","_render","self","editable","_elm","classPrefix","body","on","e","trigger","type","toolbar","toolbarFloat","toolbarHidden","toolbarFloatOffset","_placeholder","setValue","val","trim","focus","prototype","triggerHandler","args","concat","Evented","apply","key","ref","results","el","insertBefore","wrapper","find","placeholderEl","append","blur","push","name","value","insertAfter","children","util","isEmptyNode","parseInt","css","indentWidth","show","hide","hidePopover","getValue","findAction","constructor","actions","each","i","popover","active","closest","off","selection","clear","inputManager","focused","removeData","remove","document","window","attach"],"mappings":"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","file":"../Wordpad.js","sourcesContent":["define([\n  \"skylark-langx/skylark\",\n  \"skylark-langx/langx\",\n  \"skylark-domx-query\",\n  \"skylark-domx-contents/Editable\",\n  \"skylark-widgets-base/Widget\",\n  \"./Toolbar\",\n  \"./uploader\",\n  \"./i18n\",\n  \"./addons\"\n\n],function(skylark,langx, $, Editable,Widget,Toolbar,uploader,i18n,addons){ \n\n  var Wordpad = Widget.inherit({\n      options : {\n        classes : {\n          icons : {\n            html : \"fa fa-html5\",\n            \n            header: \"fa fa-header\",\n\n            bold : \"fa fa-bold\",\n            italic : \"fa fa-italic\",\n            underline: \"fa fa-underline\",\n            strike : \"fa fa-strikethrough\",\n            fontSize : \"fa fa-text-height\",\n            fontColor: \"fa fa-font\",\n            mark : \"fa fa-pencil\",\n\n            blockquote: \"fa fa-quote-right\",\n            listul : \"fa fa-list-ul\",\n            listol : \"fa fa-list-ol\",\n            code: \"fa fa-code\",\n            table : \"fa fa-table\",\n\n            fullscreen : \"fa fa-expand\",\n\n            emoji: \"fa fa-smile-o\",\n            link : \"fa fa-link\",\n            image: \"fa fa-image\",\n            video: \"fa fa-video-camera\",\n\n            indent: \"fa fa-indent\",\n            dedent: \"fa fa-dedent\",\n            alignLeft: \"fa fa-align-left\",\n            alignCenter: \"fa fa-align-center\",\n            alignRight: \"fa fa-align-right\",\n            alignJustify: \"fa fa-align-justify\",\n\n          }\n        },\n        srcNodeRef: null,\n        placeholder: '',\n        defaultImage: 'images/image.png',\n        params: {},\n        upload: false,\n        template : \"<div class=\\\"wordpad\\\">\\n  <div class=\\\"wordpad-wrapper\\\">\\n    <div class=\\\"wordpad-placeholder\\\"></div>\\n    <div class=\\\"wordpad-body\\\" contenteditable=\\\"true\\\">\\n    </div>\\n  </div>\\n</div>\"\n      },\n\n\n    _init : function() {\n      this._actions = [];\n\n      //this.opts = langx.extend({}, this.opts, opts);\n      this.opts = this.options;\n\n      var e, editor, uploadOpts;\n      this.textarea = $(this.opts.srcNodeRef);\n\n      this.opts.placeholder = this.opts.placeholder || this.textarea.attr('placeholder');\n\n      if (!this.textarea.length) {\n        throw new Error('Wordpad: param textarea is required.');\n        return;\n      }\n\n      editor = this.textarea.data('wordpad');\n      if (editor != null) {\n        editor.destroy();\n      }\n      this.id = ++Wordpad.count;\n      this._render();\n\n\n      var self = this;\n      this.editable = new Editable(this._elm,{\n        classPrefix : \"wordpad-\",\n        textarea : this.textarea,\n        body : this.body\n      });\n\n      // TODO\n      this.editable.on(\"all\",function(e,data){\n        return self.trigger(e.type,data);\n      });\n\n      if (this.opts.upload && uploader) {\n        uploadOpts = typeof this.opts.upload === 'object' ? this.opts.upload : {};\n        this.uploader = uploader(uploadOpts);\n      }\n\n      this.toolbar = new Toolbar(this,{\n        toolbar: this.opts.toolbar,\n        toolbarFloat:  this.opts.toolbarFloat,\n        toolbarHidden:  this.opts.toolbarHidden,\n        toolbarFloatOffset:  this.opts.toolbarFloatOffset\n\n      });\n\n      if (this.opts.placeholder) {\n        this.on('valuechanged', function() {\n          return self._placeholder();\n        });\n      }\n      this.setValue(this.textarea.val().trim() || '');\n      if (this.textarea.attr('autofocus')) {\n        return self.focus();\n      }\n\n\n    }\n  });\n\n  Wordpad.prototype.triggerHandler =  Wordpad.prototype.trigger = function(type,data) {\n    var args, ref;\n    args = [type];\n    if (data) {\n      args = args.concat(data);\n    }\n    langx.Evented.prototype.trigger.apply(this, args);\n    return this;\n  };\n\n\n  //Wordpad.connect(Util);\n\n  //Wordpad.connect(InputManager);\n\n  //Wordpad.connect(Selection);\n\n  //Wordpad.connect(UndoManager);\n\n  //Wordpad.connect(Keystroke);\n\n  //Wordpad.connect(Formatter);\n\n  //Wordpad.connect(Toolbar);\n\n  //Wordpad.connect(Indentation);\n\n  //Wordpad.connect(Clipboard);\n\n  Wordpad.count = 0;\n\n\n  Wordpad.prototype._render = function() {\n    var key, ref, results, val;\n\n    //this.el = $(this._tpl).insertBefore(this.textarea);\n    this.el = $(this._elm).insertBefore (this.textarea);\n\n    this.wrapper = this.el.find('.wordpad-wrapper');\n    this.body = this.wrapper.find('.wordpad-body');\n    this.placeholderEl = this.wrapper.find('.wordpad-placeholder').append(this.opts.placeholder);\n    this.el.data('wordpad', this);\n    this.wrapper.append(this.textarea);\n    this.textarea.data('wordpad', this).blur();\n    this.body.attr('tabindex', this.textarea.attr('tabindex'));\n\n    if (this.opts.params) {\n      ref = this.opts.params;\n      results = [];\n      for (key in ref) {\n        val = ref[key];\n        results.push($('<input/>', {\n          type: 'hidden',\n          name: key,\n          value: val\n        }).insertAfter(this.textarea));\n      }\n      return results;\n    }\n  };\n\n  Wordpad.prototype._placeholder = function() {\n    var children;\n    children = this.body.children();\n    if (children.length === 0 || (children.length === 1 && this.util.isEmptyNode(children) && parseInt(children.css('margin-left') || 0) < this.opts.indentWidth)) {\n      return this.placeholderEl.show();\n    } else {\n      return this.placeholderEl.hide();\n    }\n  };\n\n  Wordpad.prototype.setValue = function(val) {\n    this.hidePopover();\n\n    this.editable.setValue(val);\n\n    return this.trigger('valuechanged');\n  };\n\n  Wordpad.prototype.getValue = function() {\n    return this.editable.getValue();\n  };\n\n  Wordpad.prototype.focus = function() {\n    return this.editable.focus();\n  };\n\n  Wordpad.prototype.blur = function() {\n    return this.editable.blur();\n  };\n\n  Wordpad.prototype.findAction = function(name) {\n    if (!this._actions[name]) {\n      if (!this.constructor.addons.actions[name]) {\n        throw new Error(\"Wordpad: invalid action \" + name);\n      }\n\n      this._actions[name] = new this.constructor.addons.actions[name]({\n        editor: this\n      });\n\n    }\n\n    return this._actions[name];\n  };\n\n  Wordpad.prototype.hidePopover = function() {\n    return this.el.find('.wordpad-popover').each(function(i, popover) {\n      popover = $(popover).data('popover');\n      if (popover.active) {\n        return popover.hide();\n      }\n    });\n  };\n\n  Wordpad.prototype.destroy = function() {\n    this.trigger('destroy');\n    this.textarea.closest('form').off('.Wordpad .wordpad-' + this.id);\n    this.selection.clear();\n    this.inputManager.focused = false;\n    this.textarea.insertBefore(this.el).hide().val('').removeData('wordpad');\n    this.el.remove();\n    $(document).off('.wordpad-' + this.id);\n    $(window).off('.wordpad-' + this.id);\n    return this.off();\n  };\n\n\n  Wordpad.Toolbar = Toolbar;\n\n  Wordpad.i18n = i18n;\n\n  Wordpad.addons = addons;\n\n\n  return skylark.attach(\"widgets.Wordpad\",Wordpad);\n\n});\n"]}