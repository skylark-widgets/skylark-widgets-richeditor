/**
 * skylark-widgets-wordpad - The skylark richeditor widget
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-widgets/skylark-widgets-wordpad/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-query","../../addons","../../Action","./VideoPopover"],function(e,t,i,r,o){var a=r.inherit({name:"video",icon:"video",htmlTag:"embed, iframe",disableTag:"pre, table, div",videoPlaceholder:"video",videoContainerClass:"video-container",videoPoster:"http://pic.yupoo.com/ccking/ESzA3WGs/svIoz.png",needFocus:!0,_init:function(){var i;return this.title=this._t(this.name),e.merge(this.editor.editable.formatter._allowedTags,["embed","iframe","video"]),e.extend(this.editor.editable.formatter._allowedAttributes,{embed:["class","width","height","type","pluginspage","src","wmode","play","loop","menu","allowscriptaccess","allowfullscreen"],iframe:["class","width","height","src","frameborder"],video:["class","width","height","poster","controls","allowfullscreen","src","data-link","data-tag"]}),t(document).on("click",".J_UploadVideoBtn",(i=this,function(e){var r;return r={link:t(".video-link").val(),width:t("#video-width").val()||100,height:t("#video-height").val()||100},t(".video-link").val(""),t("#video-width").val(""),t("#video-height").val(""),i.loadVideo(t(".J_UploadVideoBtn").data("videowrap"),r,function(){return i.editor.trigger("valuechanged")})})),this.editor.body.on("click","video",function(e){return function(i){var r,o;return r=t(i.currentTarget),e.popover.show(r),(o=document.createRange()).selectNode(r[0]),e.editor.editable.selection.range(o),e.editor.editable.util.support.onselectionchange||e.editor.trigger("selectionchanged"),!1}}(this)),this.editor.body.on("mouseenter",".wordpad-video .real-video",function(e){return function(i){var r=t(i.currentTarget).siblings("video").show();return e.popover.show(r)}}(this)),this.editor.body.on("mousedown",function(e){return function(){var i;return(i=t(".J_UploadVideoBtn").data("videowrap"))&&i.html()===e.videoPlaceholder&&(i.remove(),t(".J_UploadVideoBtn").data("videowrap",null)),e.popover.hide()}}(this)),this.editor.on("decorate",function(e){return function(i,r){return r.find("video").each(function(i,r){return e.decorate(t(r))})}}(this)),this.editor.on("undecorate",function(e){return function(i,r){return r.find("video").each(function(i,r){return e.undecorate(t(r))})}}(this)),this.popover=new o({action:this}),r.prototype._init.call(this)},decorate:function(e){var t,i;return t={tag:e.attr("data-tag"),link:e.attr("data-link"),width:e.attr("width"),height:e.attr("height")},i=this.parseVideo(t),e.parent(".wordpad-video").length>0&&this.undecorate(e),e.wrap('<p class="wordpad-video"></p>'),e.parent().prepend(i),e.hide(),e.parent()},undecorate:function(e){if(e.parent(".wordpad-video").length>0)return e.siblings(".real-video").remove(),e.parent().replaceWith(e)},_execute:function(){var e;return this,e=this.createVideo(),this.popover.show(e)},_status:function(){return this._disableStatus()},loadVideo:function(e,i,r){var o,a,n,d;if(i.link||e.attr("data-link")){i.link||(i.link=e.attr("data-link"));try{d=(o=t(i.link)).get(0).tagName.toLowerCase(),n=o.attr("src")}catch(e){e,n=i.link,d=""}i.tag=d,e.attr({"data-link":n,"data-tag":d,width:i.width||100,height:i.height||100}),(a=e.siblings(".real-video")).length?(i.link=n,a.replaceWith(this.parseVideo(i))):this.decorate(e)}else e.remove();return this.popover.hide(),r(e)},createVideo:function(){var e,i;return this.editor.editable.inputManager.focused||this.editor.focus(),(i=this.editor.editable.selection.range())&&(i.deleteContents(),this.editor.editable.selection.range(i)),e=t("<video/>").attr({poster:this.videoPoster,width:100,height:100}),i.insertNode(e[0]),this.editor.editable.selection.setRangeAfter(e,i),this.editor.trigger("valuechanged"),e},parseVideo:function(e){var t;switch(e.tag){case"embed":t='<embed class="real-video" width='+e.width+" height= "+e.height+' src="'+e.link+' "type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" wmode="transparent" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true">';break;case"iframe":t='<iframe class="real-video" width='+e.width+" height= "+e.height+' src=" '+e.link+'" frameborder=0 allowfullscreen></iframe>';break;default:t=e.link}return t}});return i.actions.video=a,a});
//# sourceMappingURL=../../sourcemaps/addons/actions/VideoAction.js.map
