{"version":3,"sources":["RichEditor.js"],"names":["define","exports","module","__isValidToReturn","obj","Array","isArray","attr","__isEmptyObject","langx","$","editable","Toolbar","uploader","i18n","RichEditor","Evented","inherit","init","opts","editor","uploadOpts","this","extend","textarea","placeholder","length","Error","data","destroy","id","count","_render","self","el","classPrefix","body","on","e","trigger","type","upload","toolbar","toolbarFloat","toolbarHidden","toolbarFloatOffset","_placeholder","setValue","val","trim","focus","prototype","triggerHandler","args","concat","apply","defaultImage","params","_tpl","key","ref","results","insertBefore","wrapper","find","placeholderEl","append","blur","push","name","value","insertAfter","children","util","isEmptyNode","parseInt","css","indentWidth","show","hide","hidePopover","getValue","each","i","popover","active","closest","off","selection","clear","inputManager","focused","removeData","remove","document","window"],"mappings":"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","file":"../RichEditor.js","sourcesContent":["define([], function () {\n    'use strict';\n    var exports = {};\n    var module = { exports: {} };\n    define([\n        'skylark-langx/langx',\n        'skylark-utils-dom/query',\n        'skylark-ui-contents/editable',\n        './Toolbar',\n        './uploader',\n        './i18n'\n    ], function (langx, $, editable, Toolbar, uploader, i18n) {\n        var RichEditor = langx.Evented.inherit({\n            init: function (opts) {\n                this.opts = langx.extend({}, this.opts, opts);\n                var e, editor, uploadOpts;\n                this.textarea = $(this.opts.textarea);\n                this.opts.placeholder = this.opts.placeholder || this.textarea.attr('placeholder');\n                if (!this.textarea.length) {\n                    throw new Error('richeditor: param textarea is required.');\n                    return;\n                }\n                editor = this.textarea.data('richeditor');\n                if (editor != null) {\n                    editor.destroy();\n                }\n                this.id = ++RichEditor.count;\n                this._render();\n                var self = this;\n                this.editable = editable(this.el, {\n                    classPrefix: 'richeditor-',\n                    textarea: this.textarea,\n                    body: this.body\n                });\n                this.editable.on('all', function (e, data) {\n                    return self.trigger(e.type, data);\n                });\n                if (this.opts.upload && uploader) {\n                    uploadOpts = typeof this.opts.upload === 'object' ? this.opts.upload : {};\n                    this.uploader = uploader(uploadOpts);\n                }\n                this.toolbar = new Toolbar(this, {\n                    toolbar: this.opts.toolbar,\n                    toolbarFloat: this.opts.toolbarFloat,\n                    toolbarHidden: this.opts.toolbarHidden,\n                    toolbarFloatOffset: this.opts.toolbarFloatOffset\n                });\n                if (this.opts.placeholder) {\n                    this.on('valuechanged', function () {\n                        return self._placeholder();\n                    });\n                }\n                this.setValue(this.textarea.val().trim() || '');\n                if (this.textarea.attr('autofocus')) {\n                    return self.focus();\n                }\n            }\n        });\n        RichEditor.prototype.triggerHandler = RichEditor.prototype.trigger = function (type, data) {\n            var args, ref;\n            args = [type];\n            if (data) {\n                args = args.concat(data);\n            }\n            langx.Evented.prototype.trigger.apply(this, args);\n            return this;\n        };\n        RichEditor.count = 0;\n        RichEditor.prototype.opts = {\n            textarea: null,\n            placeholder: '',\n            defaultImage: 'images/image.png',\n            params: {},\n            upload: false\n        };\n        RichEditor.prototype._tpl = '<div class=\"richeditor\">\\n  <div class=\"richeditor-wrapper\">\\n    <div class=\"richeditor-placeholder\"></div>\\n    <div class=\"richeditor-body\" contenteditable=\"true\">\\n    </div>\\n  </div>\\n</div>';\n        RichEditor.prototype._render = function () {\n            var key, ref, results, val;\n            this.el = $(this._tpl).insertBefore(this.textarea);\n            this.wrapper = this.el.find('.richeditor-wrapper');\n            this.body = this.wrapper.find('.richeditor-body');\n            this.placeholderEl = this.wrapper.find('.richeditor-placeholder').append(this.opts.placeholder);\n            this.el.data('richeditor', this);\n            this.wrapper.append(this.textarea);\n            this.textarea.data('richeditor', this).blur();\n            this.body.attr('tabindex', this.textarea.attr('tabindex'));\n            if (this.opts.params) {\n                ref = this.opts.params;\n                results = [];\n                for (key in ref) {\n                    val = ref[key];\n                    results.push($('<input/>', {\n                        type: 'hidden',\n                        name: key,\n                        value: val\n                    }).insertAfter(this.textarea));\n                }\n                return results;\n            }\n        };\n        RichEditor.prototype._placeholder = function () {\n            var children;\n            children = this.body.children();\n            if (children.length === 0 || children.length === 1 && this.util.isEmptyNode(children) && parseInt(children.css('margin-left') || 0) < this.opts.indentWidth) {\n                return this.placeholderEl.show();\n            } else {\n                return this.placeholderEl.hide();\n            }\n        };\n        RichEditor.prototype.setValue = function (val) {\n            this.hidePopover();\n            this.editable.setValue(val);\n            return this.trigger('valuechanged');\n        };\n        RichEditor.prototype.getValue = function () {\n            return this.editable.getValue();\n        };\n        RichEditor.prototype.focus = function () {\n            return this.editable.focus();\n        };\n        RichEditor.prototype.blur = function () {\n            return this.editable.blur();\n        };\n        RichEditor.prototype.hidePopover = function () {\n            return this.el.find('.richeditor-popover').each(function (i, popover) {\n                popover = $(popover).data('popover');\n                if (popover.active) {\n                    return popover.hide();\n                }\n            });\n        };\n        RichEditor.prototype.destroy = function () {\n            this.triggerHandler('destroy');\n            this.textarea.closest('form').off('.richeditor .richeditor-' + this.id);\n            this.selection.clear();\n            this.inputManager.focused = false;\n            this.textarea.insertBefore(this.el).hide().val('').removeData('richeditor');\n            this.el.remove();\n            $(document).off('.richeditor-' + this.id);\n            $(window).off('.richeditor-' + this.id);\n            return this.off();\n        };\n        RichEditor.Toolbar = Toolbar;\n        RichEditor.i18n = i18n;\n        return RichEditor;\n    });\n    function __isEmptyObject(obj) {\n        var attr;\n        for (attr in obj)\n            return !1;\n        return !0;\n    }\n    function __isValidToReturn(obj) {\n        return typeof obj != 'object' || Array.isArray(obj) || !__isEmptyObject(obj);\n    }\n    if (__isValidToReturn(module.exports))\n        return module.exports;\n    else if (__isValidToReturn(exports))\n        return exports;\n});"]}