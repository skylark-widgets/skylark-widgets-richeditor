{"version":3,"sources":["Toolbar.js"],"names":["define","langx","$","Toolbar","Evented","inherit","init","editor","opts","floatInitialized","initToolbarFloat","toolbarHeight","_this","this","extend","toolbar","isArray","_render","list","on","e","wrapper","find","removeClass","document","id","toolbarHidden","toolbarFloat","css","toolbarFloatOffset","width","editable","util","reflow","outerWidth","os","mobile","position","left","offset","outerHeight","placeholderEl","window","bottomEdge","scrollTop","topEdge","is","top","addClass","buttons","length","pluginName","prototype","_tpl","separator","k","len","name","ref","prependTo","constructor","Error","push","appendTo","hide","findButton","button","data","addButton","btn"],"mappings":"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","file":"../Toolbar.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/query\"\r\n],function(langx,$){ \r\n\r\n  var Toolbar = langx.Evented.inherit({\r\n    init : function(editor,opts) {\r\n      var floatInitialized, initToolbarFloat, toolbarHeight;\r\n      this.editor = editor;\r\n\r\n      this.opts = langx.extend({}, this.opts, opts);\r\n\r\n      if (!this.opts.toolbar) {\r\n        return;\r\n      }\r\n      if (!langx.isArray(this.opts.toolbar)) {\r\n        this.opts.toolbar = ['bold', 'italic', 'underline', 'strikethrough', '|', 'ol', 'ul', 'blockquote', 'code', '|', 'link', 'image', '|', 'indent', 'outdent'];\r\n      }\r\n      this._render();\r\n      this.list.on('click', function(e) {\r\n        return false;\r\n      });\r\n      this.wrapper.on('mousedown', (function(_this) {\r\n        return function(e) {\r\n          return _this.list.find('.menu-on').removeClass('.menu-on');\r\n        };\r\n      })(this));\r\n      $(document).on('mousedown.richeditor' + this.editor.id, (function(_this) {\r\n        return function(e) {\r\n          return _this.list.find('.menu-on').removeClass('.menu-on');\r\n        };\r\n      })(this));\r\n      if (!this.opts.toolbarHidden && this.opts.toolbarFloat) {\r\n        this.wrapper.css('top', this.opts.toolbarFloatOffset);\r\n        toolbarHeight = 0;\r\n        initToolbarFloat = (function(_this) {\r\n          return function() {\r\n            _this.wrapper.css('position', 'static');\r\n            _this.wrapper.width('auto');\r\n            _this.editor.editable.util.reflow(_this.wrapper);\r\n            _this.wrapper.width(_this.wrapper.outerWidth());\r\n            _this.wrapper.css('left', _this.editor.editable.util.os.mobile ? _this.wrapper.position().left : _this.wrapper.offset().left);\r\n            _this.wrapper.css('position', '');\r\n            toolbarHeight = _this.wrapper.outerHeight();\r\n            _this.editor.placeholderEl.css('top', toolbarHeight);\r\n            return true;\r\n          };\r\n        })(this);\r\n        floatInitialized = null;\r\n        $(window).on('resize.richeditor-' + this.editor.id, function(e) {\r\n          return floatInitialized = initToolbarFloat();\r\n        });\r\n        $(window).on('scroll.richeditor-' + this.editor.id, (function(_this) {\r\n          return function(e) {\r\n            var bottomEdge, scrollTop, topEdge;\r\n            if (!_this.wrapper.is(':visible')) {\r\n              return;\r\n            }\r\n            topEdge = _this.editor.wrapper.offset().top;\r\n            bottomEdge = topEdge + _this.editor.wrapper.outerHeight() - 80;\r\n            scrollTop = $(document).scrollTop() + _this.opts.toolbarFloatOffset;\r\n            if (scrollTop <= topEdge || scrollTop >= bottomEdge) {\r\n              _this.editor.wrapper.removeClass('toolbar-floating').css('padding-top', '');\r\n              if (_this.editor.editable.util.os.mobile) {\r\n                return _this.wrapper.css('top', _this.opts.toolbarFloatOffset);\r\n              }\r\n            } else {\r\n              floatInitialized || (floatInitialized = initToolbarFloat());\r\n              _this.editor.wrapper.addClass('toolbar-floating').css('padding-top', toolbarHeight);\r\n              if (_this.editor.editable.util.os.mobile) {\r\n                return _this.wrapper.css('top', scrollTop - topEdge + _this.opts.toolbarFloatOffset);\r\n              }\r\n            }\r\n          };\r\n        })(this));\r\n      }\r\n      this.editor.on('destroy', (function(_this) {\r\n        return function() {\r\n          return _this.buttons.length = 0;\r\n        };\r\n      })(this));\r\n      $(document).on(\"mousedown.richeditor-\" + this.editor.id, (function(_this) {\r\n        return function(e) {\r\n          return _this.list.find('li.menu-on').removeClass('menu-on');\r\n        };\r\n      })(this));\r\n    }\r\n\r\n  });\r\n\r\n  Toolbar.pluginName = 'Toolbar';\r\n\r\n  Toolbar.prototype.opts = {\r\n    toolbar: true,\r\n    toolbarFloat: true,\r\n    toolbarHidden: false,\r\n    toolbarFloatOffset: 0\r\n  };\r\n\r\n  Toolbar.prototype._tpl = {\r\n    wrapper: '<div class=\"richeditor-toolbar\"><ul></ul></div>',\r\n    separator: '<li><span class=\"separator\"></span></li>'\r\n  };\r\n\r\n\r\n  Toolbar.prototype._render = function() {\r\n    var k, len, name, ref;\r\n    this.buttons = [];\r\n    this.wrapper = $(this._tpl.wrapper).prependTo(this.editor.wrapper);\r\n    this.list = this.wrapper.find('ul');\r\n    ref = this.opts.toolbar;\r\n    for (k = 0, len = ref.length; k < len; k++) {\r\n      name = ref[k];\r\n      if (name === '|') {\r\n        $(this._tpl.separator).appendTo(this.list);\r\n        continue;\r\n      }\r\n      if (!this.constructor.buttons[name]) {\r\n        throw new Error(\"richeditor: invalid toolbar button \" + name);\r\n        continue;\r\n      }\r\n      this.buttons.push(new this.constructor.buttons[name]({\r\n        toolbar : this,\r\n        editor: this.editor\r\n      }));\r\n    }\r\n    if (this.opts.toolbarHidden) {\r\n      return this.wrapper.hide();\r\n    }\r\n  };\r\n\r\n  Toolbar.prototype.findButton = function(name) {\r\n    var button;\r\n    button = this.list.find('.toolbar-item-' + name).data('button');\r\n    return button != null ? button : null;\r\n  };\r\n\r\n  Toolbar.addButton = function(btn) {\r\n    return this.buttons[btn.prototype.name] = btn;\r\n  };\r\n\r\n  Toolbar.buttons = {};\r\n\r\n  return Toolbar;\r\n\r\n});"]}